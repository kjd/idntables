<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Representing Label Generation Rulesets using XML</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Representing Label Generation Rulesets using XML">
<meta name="generator" content="xml2rfc v1.36 (http://xml.resource.org/)">
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">K. Davies</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">ICANN</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">A. Freytag</td></tr>
<tr><td class="header">Expires: September 26, 2014</td><td class="header">ASMUS Inc.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 25, 2014</td></tr>
</table></td></tr></table>
<h1><br />Representing Label Generation Rulesets using XML<br />draft-davies-idntables-07</h1>

<h3>Abstract</h3>

<p>This document describes a method of representing a key part of the domain name registration policy for a zone administrator
                using Extensible Markup Language (XML). These policies, known as "Label Generation Rulesets" (LGRs), are
                particularly used for the implementation of Internationalized Domain Names (IDNs). The rulesets are used
                to implement and share that aspect of policy defining which labels and specific Unicode code points are permitted for registrations,
                which alternative code points are considered variants, and what actions may be performed on labels containing those
                variants.
            
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on September 26, 2014.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2014 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Design Goals<br />
<a href="#anchor3">3.</a>&nbsp;
Requirements<br />
<a href="#anchor4">4.</a>&nbsp;
LGR Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.1.</a>&nbsp;
Namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.2.</a>&nbsp;
Basic Structure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.3.</a>&nbsp;
Metadata<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.3.1.</a>&nbsp;
The version Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.3.2.</a>&nbsp;
The date Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">4.3.3.</a>&nbsp;
The language Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">4.3.4.</a>&nbsp;
The domain Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">4.3.5.</a>&nbsp;
The description Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">4.3.6.</a>&nbsp;
The validity-start and validity-end Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">4.3.7.</a>&nbsp;
The unicode-version Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#references">4.3.8.</a>&nbsp;
The references Element<br />
<a href="#anchor15">5.</a>&nbsp;
Code Points and Variants<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sequences">5.1.</a>&nbsp;
Sequences<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">5.2.</a>&nbsp;
Variants<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">5.2.1.</a>&nbsp;
Basic Variants<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">5.2.2.</a>&nbsp;
Null Variants<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">5.2.3.</a>&nbsp;
Dispositions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ref">5.2.4.</a>&nbsp;
The ref Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reflexive_mapping">5.2.5.</a>&nbsp;
Variants with Reflexive Mapping<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#when">5.2.6.</a>&nbsp;
Conditional Variants<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#comment">5.2.7.</a>&nbsp;
The comment Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tagging">5.3.</a>&nbsp;
Code Point Tagging<br />
<a href="#anchor20">6.</a>&nbsp;
Whole Label and Context Evaluation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">6.1.</a>&nbsp;
Basic Concepts<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">6.2.</a>&nbsp;
Character Classes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tag_based_classes">6.2.1.</a>&nbsp;
Tag-based Classes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#property">6.2.2.</a>&nbsp;
Unicode Property-based Classes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">6.2.3.</a>&nbsp;
Explicitly Declared Classes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#combined_classes">6.2.4.</a>&nbsp;
Combined Classes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">6.3.</a>&nbsp;
Whole Label and Context Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rule">6.3.1.</a>&nbsp;
The rule Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#match_operators">6.3.2.</a>&nbsp;
The Match Operators<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">6.3.3.</a>&nbsp;
The count Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">6.3.4.</a>&nbsp;
The name and by-ref Attributes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">6.3.5.</a>&nbsp;
The choice Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">6.3.6.</a>&nbsp;
Literal Code Point Sequences<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">6.3.7.</a>&nbsp;
The any Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">6.3.8.</a>&nbsp;
The start and end Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#IDNA2008-example">6.3.9.</a>&nbsp;
Example rule from IDNA2008<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#parameterized_context_rule">6.4.</a>&nbsp;
Parameterized Context or When Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">6.4.1.</a>&nbsp;
The anchor Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">6.4.2.</a>&nbsp;
The look-behind and look-ahead Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#omitting">6.4.3.</a>&nbsp;
Omitting the anchor Element<br />
<a href="#actions">7.</a>&nbsp;
The action Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#match_attribute">7.1.</a>&nbsp;
The match and not-match Attributes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#variants_actions">7.2.</a>&nbsp;
Actions matching Variant Dispositions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#variant_triggers">7.2.1.</a>&nbsp;
Variant Disposition triggers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc3743_example">7.2.2.</a>&nbsp;
Example for RFC3743-style Tables<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#recommended_disposition_values">7.3.</a>&nbsp;
Recommended Disposition Values<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#precedence">7.4.</a>&nbsp;
Precedence<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#implied_actions">7.5.</a>&nbsp;
Implied Actions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#default_actions">7.6.</a>&nbsp;
Default Actions<br />
<a href="#processing">8.</a>&nbsp;
Processing a Label Against an LGR<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">8.1.</a>&nbsp;
Determining Eligibility for a Label<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor34">8.2.</a>&nbsp;
Determining Variants for a Label<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#determining_dispositions">8.3.</a>&nbsp;
Determining a  Disposition for a Label or variant Label<br />
<a href="#anchor35">9.</a>&nbsp;
Conversion to and from Other Formats<br />
<a href="#anchor36">10.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor37">11.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
<a href="#anchor39">Appendix&nbsp;A.</a>&nbsp;
Example Tables<br />
<a href="#translate_rfc3743">Appendix&nbsp;B.</a>&nbsp;
How to Translate RFC 3743 based Tables into the XML Format<br />
<a href="#indic_syllable">Appendix&nbsp;C.</a>&nbsp;
Indic Syllable Structure Example<br />
<a href="#anchor40">Appendix&nbsp;D.</a>&nbsp;
RelaxNG Schema<br />
<a href="#anchor41">Appendix&nbsp;E.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor42">Appendix&nbsp;F.</a>&nbsp;
Editorial Notes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor43">F.1.</a>&nbsp;
Known Issues and Future Work<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor44">F.2.</a>&nbsp;
Change History<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This memo describes a method of using Extensible Markup Language (XML) to describe the algorithm used to
                determine whether a given domain label is permitted, and under which conditions, based on the code points
                it contains and their context. These algorithms are comprised of a list of permissible code points,
                variant code point mappings, and a set of rules acting on them. These algorithms
                form part of a zone administrator's policies, and can be referred to as Label Generation Rulesets
                (LGRs), or IDN tables.
            
</p>
<p>There are other kinds policies relating to labels which are not normally covered by Label Generation Rulesets and 
			    are therefore not representable by the XML format described here. These include, but are not limited to
				policies around trademarks, or prohibition of fraudulent or objectionable words.
			
</p>
<p>Administrators of the zones for top-level domain registries have historically published their LGRs using
                ASCII text or HTML. The formatting of these documents has been loosely based on the format used for the
                Language Variant Table in <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a>.
                <a class='info' href='#RFC4290'>[RFC4290]<span> (</span><span class='info'>Klensin, J., &ldquo;Suggested Practices for Registration of Internationalized Domain Names (IDN),&rdquo; December&nbsp;2005.</span><span>)</span></a>
                also provides a "model table format" that describes a similar set of functionality. Common to these formats
                is that the algorithms used to evaluate the data therein are implicit or specified elsewhere.
            
</p>
<p>Through the first decade of IDN deployment, experience has shown that LGRs derived from these formats are
                difficult to consistently implement and compare due to their differing formats. A universal format, such
                as one using a structured XML format, will assist by improving machine-readability, consistency,
                reusability and maintainability of LGRs.
			
</p>
<p>When used to represent simple list of permitted code points, the format is quite straightforward.
				At the cost of some complexity in the resulting file, it also allows for an implementation of more sophisticated
				handling of conditional variants that reflects the known requirements of current zone administrator policies.
            
</p>
<p>Another feature of this format is that it allows many of the algorithms to be made explicit and machine
                implementable. A remaining small set of implicit algorithms is described in this document to allow commonality
                in implementation.
            
</p>
<p>While the predominant usage of this specification is to represent IDN label policy, the format is not
                limited to IDN usage may also be used for describing ASCII domain name label rulesets.
            
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Design Goals</h3>

<p>The following items are explicit design goals of this format:
</p>
<p>
                </p>
<ul class="text">
<li>MUST be in a format that can be implemented in a reasonably straightforward manner in software;
                    
</li>
<li>The format SHOULD be able to be checked for formatting errors, such that common mistakes can be
                        caught;
                    
</li>
<li>An LGR MUST be able to express the set of valid code points that are allowed for registration
                        under a specific zone administrator's policies;
                    
</li>
<li>MUST be able to express computed alternatives to a given domain name based on mapping relationships 
                        between code points, whether one-to-one or many-to-many. These computed alternatives are commonly
                        known as "variants";
                    
</li>
<li>Variant code points SHOULD be able to be tagged with specific dispositions or categories that can be
                        used to support registry policy (such as whether to allocate the computed variant in the zone, or to
                        merely block it from registration);
                    
</li>
<li>Variants and code points MUST be able to stipulated based on contextual information. For example, specific
                        variants may only be applicable when they follow another specific code point, or when the code
                        point is displayed in a specific presentation form;
                    
</li>
<li>The data contained within an LGR MUST be able to be interpreted unambiguously, such that independent 
                        implementations that utilize the contents will arrive at the same results;
                    
</li>
<li>To the largest extent possible, policy rules SHOULD be able to be specified in the XML format without relying
                        hidden, or built-in algorithms in implementations.
</li>
<li>LGRs SHOULD be suitable for comparison and re-use, such that one could easily compare the
                        contents of two or more to see the differences, to merge them, and so on.
                    
</li>
<li>LGRs SHOULD be able to be merged automatically, at the minimum where code points and variant information is
                        concerned.
                    
</li>
<li>As many existing IDN tables as practicable SHOULD be able to be migrated to the LGR format with
                        all applicable logic retained.
                    
</li>
</ul><p>
            
</p>
<p>It is explicitly NOT the goal of this format to stipulate what code points should be listed in an LGR by
                a zone administrator. Which registration policies are used for a particular zone is outside the scope of
                this memo.
            
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Requirements</h3>

<p>To be able to fulfill the known utilization of LGRs,
                the existing corpus of published IDN tables were reviewed to prepare this specification.
            
</p>
<p>In addition, the requirements of ICANN's work to implement an LGR for the DNS Root Zone
                <a class='info' href='#LGR-PROCEDURE'>[LGR&#8209;PROCEDURE]<span> (</span><span class='info'>Internet Corporation for Assigned Names and Numbers, &ldquo;Procedure to Develop and Maintain the Label Generation Rules for the Root Zone in Respect of                         IDNA Labels,&rdquo; .</span><span>)</span></a>
                were also considered. In particular, Section B of that document identifies five specific requirements for an LGR methodology.
            
</p>
<p>Finally, the syntax and rules in
                <a class='info' href='#RFC5892'>[RFC5892]<span> (</span><span class='info'>Faltstrom, P., &ldquo;The Unicode Code Points and Internationalized Domain Names for Applications (IDNA),&rdquo; August&nbsp;2010.</span><span>)</span></a> and <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a>
                were reviewed.
            
</p>
<p>Altogether these reviews resulted in the following requirements:
</p>
<p>
                 </p>
<ul class="text">
<li>The ability to identify a set of code points that are permitted.
</li>
<li>The ability to include code points that are permitted only in given contexts.
</li>
<li>The ability to represent a list of variants, if any, for each code point.
</li>
<li>The ability to include variants that are defined only in given contexts.
</li>
<li>The ability to assign a single disposition or categorization for each variants
</li>
<li>The ability to assign variants with reflexive mappings.
</li>
<li>The ability to assign variants that have a code point sequence as target.
</li>
<li>The ability to express variant mappings symmetrically.
</li>
<li>A method of identifying code points that are related, using a one or several tags per code point.
</li>
<li>The ability to describe rules regarding the possible actions that may be performed on the
                        resulting label (such as block, allocatable, etc.)
                    
</li>
<li>The ability to describe rules that check for ill-formed combinations across the whole label.
</li>
<li>The ability to describe rules that define contexts in which code points are permissible or variants defined.
</li>
<li>The ability to preserve normative reference information as well as informative comments.
</li>
</ul><p>
            
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
LGR Format</h3>

<p>An LGR is expressed as a well-formed XML Document<a class='info' href='#XML'>[XML]<span> (</span><span class='info'>World Wide Web Consortium, &ldquo;Extensible Markup Language (XML) 1.0,&rdquo; .</span><span>)</span></a>.
            
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Namespace</h3>

<p>The XML Namespace URI is [TBD]. [Note: the examples and schemas for any non-final versions of this specification use a temporary namespace]
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Basic Structure</h3>

<p>The basic XML framework of the document is as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;?xml version="1.0"?&gt;
    &lt;lgr xmlns="http://www.iana.org/lgr/0.1"&gt;
        ...
    &lt;/lgr&gt;</pre></div>
<p>Within the "lgr" element rest several sub-elements. First is an optional "meta" element that contains all
                    meta-data associated with the LGR, such as its authorship, what it is used for, implementation
                    notes and references. This is followed by a "data" element that contains the substantive code point
                    data. Finally, an optional "rules" element contains information on contextual and whole-label evaluation
                    rules, if any, along with any specific action elements providing for the disposition of labels and computed
                    variant labels.
                
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;?xml version="1.0"?&gt;
    &lt;lgr xmlns="http://www.iana.org/lgr/0.1"&gt;
        &lt;meta&gt;
            ...
        &lt;/meta&gt;
        &lt;data&gt;
            ...
        &lt;/data&gt;
        &lt;rules&gt;
            ...
        &lt;/rules&gt;
    &lt;/lgr&gt;
</pre></div>
<p>A document MUST contain exactly one "lgr" element. Each "lgr" element MUST contain exactly one "data"
                    element, optionally preceded by one "meta" element and optionally followed by one "rules" element.
                
</p>
<p>In the following descriptions, required, non-repeating elements or attributes are generally not called out
				 explicitly, in contrast to optional ones or those that may be repeated.
				
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Metadata</h3>

<p>The optional "meta" element is used to express meta-data associated within the LGR. It can be used to identify
                    the author or relevant contact person, explain the intended usage of the LGR, and provide
                    implementation notes as well as references. The data contained within is not required by software
                    consuming the LGR in order to calculate valid labels, or to calculate variants. However, the
                    "unicode-version" element MUST be used by a consumer of the table  to identify that it has the correct
                    Unicode property data to perform operations on the table.
                
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1"></a><h3>4.3.1.&nbsp;
The version Element</h3>

<p>The "version" element is optional. It is used to uniquely identify each version of the LGR being represented. No
                        specific format is required, but it is RECOMMENDED that it be a the decimal representation of a single positive integer,
                        which is incremented with each revision of the file.
                    
</p>
<p>An example of a typical first edition of a document:
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;version&gt;1&lt;/version&gt;
</pre></div><p>

</p>
<p>The version element may have an optional "comment" attribute.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;version comment="draft"&gt;1&lt;/version&gt;
</pre></div><p>

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.2"></a><h3>4.3.2.&nbsp;
The date Element</h3>

<p>The optional "date" element is used to identify the date the LGR was posted. The contents of this element
                        MUST be a valid ISO 8601 full-date string as described in <a class='info' href='#RFC3339'>[RFC3339]<span> (</span><span class='info'>Klyne, G., Ed. and C. Newman, &ldquo;Date and Time on the Internet: Timestamps,&rdquo; July&nbsp;2002.</span><span>)</span></a>.
                    
</p>
<p>Example of a date:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;date&gt;2009-11-01&lt;/date&gt;
</pre></div>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3"></a><h3>4.3.3.&nbsp;
The language Element</h3>

<p>The optional "language" element signals that the LGR is associated with a specific language or script. The
                        value of the language element MUST be a valid language tag as described in <a class='info' href='#RFC5646'>[RFC5646]<span> (</span><span class='info'>Phillips, A. and M. Davis, &ldquo;Tags for Identifying Languages,&rdquo; September&nbsp;2009.</span><span>)</span></a>. The tag may refer to a script plus undefined language if the LGR is not referring to
                        a specific language.
                    
</p>
<p>Example of an English language LGR:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   &lt;language&gt;en&lt;/language&gt;
</pre></div>
<p>If the LGR applies to a specific script, rather than a language, the "und" language tag should be
                        used followed by the relevant
                        <a class='info' href='#RFC5646'>[RFC5646]<span> (</span><span class='info'>Phillips, A. and M. Davis, &ldquo;Tags for Identifying Languages,&rdquo; September&nbsp;2009.</span><span>)</span></a>
                        script subtag. For example, for a Cyrillic script LGR:
                    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   &lt;language&gt;und-Cyrl&lt;/language&gt;
</pre></div>
<p>If the LGR covers a specific set of multiple languages or scripts, the language element can be
                        repeated. However, for cases of a script-specific LGR exhibiting insignificant admixture of code points
                        from other scripts, it is RECOMMENDED to the use a single "language" element identifying the
                        predominant script. In the exceptional case of a multi-script LGR where no script is predominant,
                        use Zyyy (Common):
                    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   &lt;language&gt;und-Zyyy&lt;/language&gt;
</pre></div>
<p>Note that that for the particular case of Japanese, a script tag "Japn" exists that matches the
                        mixture of scripts used in writing that language. The preferred language element would be:
                    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   &lt;language&gt;und-Japn&lt;/language&gt;
</pre></div>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.4"></a><h3>4.3.4.&nbsp;
The domain Element</h3>

<p>This optional element refers to a domain to which this policy is applied. The value must be a valid 
                    domain name that represents the apex of the zone to which the domain is applied, and in the case of
                    the root zone, should be represented as ".".
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;domain&gt;example.com&lt;/domain&gt;</pre></div><p>

</p>
<p>There may be multiple &lt;domain&gt; tags used to
                        reflect a list of domains.
                    
</p>
<p>[TODO: consider &lt;scope type="domain"&gt;, to broaden applicability to other scopes]
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.5"></a><h3>4.3.5.&nbsp;
The description Element</h3>

<p>The "description" element is an optional free-form element that contains any additional relevant
                        description that is useful for the user in its interpretation. Typically, this field contains
                        authorship information, as well as additional context on how the LGR was formulated (such as
                        citations and references), and how it has been applied.
                    
</p>
<p>The element has an optional "type" attribute, which refers to the internet media type of the enclosed
                        data. Typical types would be "text/plain" or "text/html". The attribute SHOULD be a valid MIME 
                        type. If supplied, it will be assumed the contents is content
                        of that media type.  If the description lacks a type field, it will 
                        be assumed to be plain text ("text/plain").
                    
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.6"></a><h3>4.3.6.&nbsp;
The validity-start and validity-end Elements</h3>

<p>The "validity-start" and "validity-end" elements are optional elements that describe the time
                        period from which the contents of the LGR become valid (i.e. are used in registry policy), and
                        the contents of the LGR cease to be used.
                    
</p>
<p>The dates MUST confirm to the "full-date" format described in section 5.6 of <a class='info' href='#RFC3339'>[RFC3339]<span> (</span><span class='info'>Klyne, G., Ed. and C. Newman, &ldquo;Date and Time on the Internet: Timestamps,&rdquo; July&nbsp;2002.</span><span>)</span></a>.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;validity-start&gt;2014-03-12&lt;/validity-start&gt;</pre></div><p>

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.7"></a><h3>4.3.7.&nbsp;
The unicode-version Element</h3>

<p>Whenever an LGR depends on character properties from a given version of the Unicode
                        standard, the version number used in creating the LGR MUST be listed in the form x.y.z, where
						x, y, and z are positive, decimal integers (see <a class='info' href='#Unicode-Versions'>[Unicode&#8209;Versions]<span> (</span><span class='info'>Unicode Consortium, &ldquo;Unicode Version Numbering,&rdquo; .</span><span>)</span></a>).
						If any software processing the table does
                        not have access to character property data of 
                        the requisite version, it MUST NOT perform any operations relating to whole-label
                        evaluation relying on Unicode properties (<a class='info' href='#property'>Section&nbsp;6.2.2<span> (</span><span class='info'>Unicode Property-based Classes</span><span>)</span></a>).
</p>
<p>
                        The value of a given Unicode property in<a class='info' href='#UAX42'>[UAX42]<span> (</span><span class='info'>Unicode Consortium, &ldquo;Unicode Character Database in XML,&rdquo; .</span><span>)</span></a>may change between versions, 
						unless such change has been explicitly 
						disallowed in <a class='info' href='#Unicode-Stability'>[Unicode&#8209;Stability]<span> (</span><span class='info'>Unicode Consortium, &ldquo;Unicode Encoding Stability Policy, Property Value Stability,&rdquo; .</span><span>)</span></a>.  It is RECOMMENDED to only reference stable
                        or immutable properties, or, where possible, to provide explicit lists of code points instead.
						
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;unicode-version&gt;6.2.0&lt;/unicode-version&gt;
</pre></div><p>

</p>
<p>It is not necessary to include a "unicode-version" element for LGRs that do not make use of
                        Unicode properties, however, it is RECOMMENDED. 
                    
</p>
<a name="references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.8"></a><h3>4.3.8.&nbsp;
The references Element</h3>

<p>A Label Generation Ruleset may define a list of references which are used to associate
                       various elements in the LGR to one or more normative references. In contrast, global references for
                       the entire LGR can simply be part of the "description" element.
</p>
<p>References are specified in an optional "references" element contains any number of "reference" elements,
                         each with a unique "id" attribute. It is RECOMMENDED that the "id" attribute be an zero-based integer. The value
                        of each "reference" element SHOULD be the citation of a standard, dictionary or other specification in any suitable
                        format. In addition to an "id" attribute, a reference element may have a "comment" attribute
                        for an optional free-form annotation.
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;references&gt;
      &lt;reference id="0"&gt;The Unicode Standard, Version 7.0&lt;/reference&gt;
      &lt;reference id="1"&gt;Big-5: Computer Chinese Glyph and Character
         Code Mapping Table, Technical Report C-26, 1984&lt;/reference&gt;
      &lt;reference id="2" comment="synchronized with Unicode 6.1"&gt;
         ISO/IEC
         10646:2012 3rd edition&lt;/reference&gt;
      ...
    &lt;/references&gt;
    ...
    &lt;data&gt;
      &lt;char cp="0620" ref="0 2" /&gt;
      ...
    &lt;/data&gt;</pre></div><p>

</p>
<p> A reference can be associated with many types of elements in the "data" or "rules" sections of the LGR by using an
                    optional "ref" attribute (see <a class='info' href='#ref'>Section&nbsp;5.2.4<span> (</span><span class='info'>The ref Attribute</span><span>)</span></a>). A "ref" attribute may not occur on elements that are named references
                    to character classes and rules nor on certain specific other element types. See description of these elements below.
                    
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Code Points and Variants</h3>

<p>The bulk of a label generation ruleset is a description of which set of code points are eligible for a
                given label. For rulesets that perform operations that result in potential variants, the code
                point-level relationships between variants need to also be described.
            
</p>
<p>The code point data is collected within a "data" element. Within this element, a series of "char" and
                "range" elements describe eligible code points, or ranges of code points, respectively.
            
</p>
<p>Discrete permissible code points or code point sequences are declared with a "char" element, e.g.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="002D"/&gt;</pre></div><p>

</p>
<p>Ranges of permissible code points may be stipulated with a "range" element, e.g.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;range first-cp="0030" last-cp="0039"/&gt;</pre></div><p>

</p>
<p>The range is inclusive of the first and last code points. Whether code points are specified individually
                or as part of a range makes no difference in processing the data, and tools reading or writing the
                XML format are not required to retain a distinction. All attributes defined for a range element are as if applied
                to each code point within. A range element has no child elements.
            
</p>
<p>Code points must be expressed in uppercase, hexadecimal, and zero padded to a minimum of 4 digits - in
                other words according to the standard Unicode convention but without the prefix "U+". The rationale for
                not allowing other encoding formats, including native Unicode encoding in XML, is explored in <a class='info' href='#UAX42'>[UAX42]<span> (</span><span class='info'>Unicode Consortium, &ldquo;Unicode Character Database in XML,&rdquo; .</span><span>)</span></a>. The XML conventions used in this format, including the element and attribute
                names, mirror this document where practical and reasonable to do so. It is RECOMMENDED to list
                all "char" elements  in ascending order of cp attribute.
            
</p>
<a name="sequences"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Sequences</h3>

<p>A sequence of two or more code points may be specified in a LGR, for example, when defining the
                    source for n:m variant mappings. Another use of sequences would be in cases when the exact sequence
                    of code points is required to occur in order for the constituent elements to be eligible, such as
                    when a specific code point is only eligible when preceded or followed by another code point. The
                    following would define the eligibility of the MIDDLE DOT (U+00B7) only when both preceded and
                    followed by the LATIN SMALL LETTER L (U+006C):
                
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="006C 00B7 006C" comment="Catalan middle dot"/&gt;</pre></div><p>

</p>
<p>As an alternative to using sequences to define a required context, a "char" or "range" element may
                    specify conditional context using an optional "when" attribute as described below in <a class='info' href='#when'>Section&nbsp;5.2.6<span> (</span><span class='info'>Conditional Variants</span><span>)</span></a>. The
                    latter method is more flexible in that such conditional context is not limited to specific code
                    point in addition to allowing both prohibited as well as required context to be specified.
                
</p>
<p>As described below, the "char" element, whether or not it is used for a single code point, or for a sequence,
				may have optional child elements defining variants.  Both the "char" and "range" elements can take a number 
				of optional attributes for conditional inclusion, commenting, cross referencing and character tagging, as described below.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Variants</h3>

<p>Most LGRs typically only determine simple code point eligibility,  and for them, the elements described so far
				    would be the only ones required for their "data" section.  Others additionally specify a
                    mapping of code points to other code points, known as "variants". What constitutes a variant code point is a
                    matter of policy, and varies for each implementation. The following examples are intended to
                    demonstrate the syntax; they are not necessarily typical.
                
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
Basic Variants</h3>

<p>Variant code points are specified using one of more "var" elements as children of a "char" element. 
					The target mapping is specified using the "cp" attribute. Other, optional attributes for the var element
					are described below.
</p>
<p>For example, to map LATIN SMALL LETTER V (U+0076) as a variant of LATIN SMALL LETTER U
                        (U+0075):
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="0075"&gt;
        &lt;var cp="0076"/&gt;
    &lt;/char&gt;</pre></div><p>

</p>
<p>A sequence of multiple code points can be specified as a variant of a single code point. For
                        example, the sequence of LATIN SMALL LETTER O (U+006F) then LATIN SMALL LETTER E (U+0065) might
                        hypothetically be specified as a variant for an LATIN SMALL LETTER O WITH DIAERESIS (U+00F6) as
                        follows:
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="00F6"&gt;
        &lt;var cp="006F 0065"/&gt;
    &lt;/char&gt;</pre></div><p>

</p>
<p>The "var" element specifies variant mappings in only one direction, even though the variant relation is
                        usually considered symmetric, that is, if A is a variant of B then B should also be a variant
                        of A. The format requires that the inverse of the variant be given explicitly to fully specify
                        symmetric variant relations in the LGR. This has the beneficial side effect of making the
                        symmetry explicit:
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="006F 0065"&gt;
        &lt;var cp="00F6"/&gt;
    &lt;/char&gt;</pre></div><p>

</p>
<p>Both the source and target of a variant mapping may be sequences. As it is not possible to
                        specify variants for ranges, ranges cannot be used for code points for which variant relations
                        need to be defined.
                    
</p>
<p>All variants MUST be unique. For a given "char" element all variants must have a unique
                     combination of "cp" , "when" and "not-when" attributes. It is RECOMMENDED to list the
                     "var" elements  in ascending order of their target code point sequence.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
Null Variants</h3>

<p>To specify a null variant, which is a variant string that maps to no code point, use an empty cp
                        attribute. For example, to mark a string with a ZERO WIDTH NON-JOINER (U+200C) to the same
                        string without the ZERO WIDTH NON-JOINER:
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="200C"&gt;
        &lt;var cp=""/&gt;
    &lt;/char&gt;</pre></div><p>

</p>
<p>This is useful in expressing the intent that some code points in a label are to be mapped away when 
                    generating a canonical variant of the label.  However, in tables that are designed to have symmetric
                    variant mappings, this could lead to combinatorial explosion, if not handled carefully.
</p>
<p>The symmetric form of a null variant is expressed as follows:
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp=""&gt;
        &lt;var cp="200C" disp="invalid" /&gt;
    &lt;/char&gt;</pre></div><p>

</p>
<p>A char element with an empty "cp" attribute MUST specify at least one variant mapping, or the results
                    are undefined. It is strongly RECOMMENDED to use a disposition of  'invalid" or equivalent when defining variant
                    mappings from null sequences, so that variant mapping from null sequences are removed in variant label generation.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
Dispositions</h3>

<p>Variants may be given dispositions with the optional "disp" attribute. Dispositions describe the policy state 
				for a variant label that was
                    generated using a particular variant. The dispositions are the same as described below in
                    <a class='info' href='#actions'>Section&nbsp;7<span> (</span><span class='info'>The action Element</span><span>)</span></a>. 
                
</p>
<p>A disposition may be of any non-empty value not starting with an underscore and not containing 
                     spaces.       Within these restrictions a disposition may have any value, but several conventional dispositions are
                     predefined below in  <a class='info' href='#actions'>Section&nbsp;7<span> (</span><span class='info'>The action Element</span><span>)</span></a>  to encourage common conventions in their application. If these values can represent registry
                    policy, they SHOULD be used. (See also
                    <a class='info' href='#default_actions'>Section&nbsp;7.6<span> (</span><span class='info'>Default Actions</span><span>)</span></a>
                    ). 
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="767C"&gt;
        &lt;var cp="53D1" disp="allocate"/&gt;
        &lt;var cp="5F42" disp="block"/&gt;
        &lt;var cp="9AEA" disp="block"/&gt;
        &lt;var cp="9AEE" disp="block"/&gt;
    &lt;/char&gt;</pre></div><p>

</p>
<p>Usually, if a variant label contains any instance of one of the variants that are to be blocked the label would
                        be blocked, but if it contained only instances of variants to be allocated it could be allocated. See
                        the discussion about implied actions in <a class='info' href='#default_actions'>Section&nbsp;7.6<span> (</span><span class='info'>Default Actions</span><span>)</span></a>.
                    
</p>
<p>Because variants MUST be unique, it is not possible to define the same  variant for the same
                    "char" element with different dispositions (see however <a class='info' href='#when'>Section&nbsp;5.2.6<span> (</span><span class='info'>Conditional Variants</span><span>)</span></a>).
</p>
<a name="ref"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4"></a><h3>5.2.4.&nbsp;
The ref Attribute</h3>

<p>Reference information may optionally be specified by a "ref" attribute, consisting of a space
                        delimited sequence of reference identifiers.
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="522A" ref="0"&gt;
        &lt;var cp="5220" ref="2 3"/&gt;
        &lt;var cp="5220" ref="2 3"/&gt;
    &lt;/char&gt;</pre></div><p>

</p>
<p>This facility is typically used to give source information for code points or variant relations.
                        This information is ignored when machine-processing an LGR. Specifying a "ref" attribute on a
                        range element is equivalent to specifying the same ref attribute on every single code point of
                        the range. All reference identifiers MUST be from the set declared in the "references" element (see
                        <a class='info' href='#references'>Section&nbsp;4.3.8<span> (</span><span class='info'>The references Element</span><span>)</span></a>).  It is RECOMMENDED that they be listed in ascending order.
                    
</p>
<p>In addition to "char", "range" and "var" elements in the data section, a ref attribute may be
                        present in the rules section for these elements:  actions, literals ("char" inside a rule), as well as 
						for definitions of rules and classes, but not for
                        named references to them.  In other words, the use of the "by-ref" and "ref" attributes are mutually
						exclusive. There are no "ref" attributes permitted on any element in the metadata.
                    
</p>
<a name="reflexive_mapping"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5"></a><h3>5.2.5.&nbsp;
Variants with Reflexive Mapping</h3>

<p>At first sight there seems to be no call for adding variant mappings for which source and target
                code points are the same, that is for which the mapping is reflexive, or, in other words, an identity mapping.
                Yet such reflexive mappings occur frequently in LGRs that follow <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a>.
                
</p>
<p>
                Adding a "var" element  allows both a disposition and a reference id
                to be specified for it. While the reference id is not used in processing, the disposition value can be used
                to trigger actions. In permuting the label to generate all possible variants, the disposition value associated
                with a reflexive    variant mapping is applied to any of the permuted labels containing the original code point.
</p>
<p>
                In the following example, the code point U+3473 exists both as a variant of  U+3447 and as a
                variant of itself (reflexive mapping). Assuming an original label of "3473 3447", the permuted variant "3473 3473"
                would consist of the reflexive variant of 3473 followed by a variant of 3447. Accordingly, the
                dispositions for both of the variant mappings used to generate that particular permutation would
                have the value "preferred" given the following definitions of variant mappings:
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>     &lt;char cp="3447" ref="0"&gt;
      &lt;var cp="3473" disp="preferred" ref="1 3" /&gt;
    &lt;/char&gt;
    &lt;char cp="3473" ref="0"&gt;
      &lt;var cp="3447" disp="block" ref="1 3" /&gt;
      &lt;var cp="3473" disp="preferred" ref="0" /&gt;
    &lt;/char&gt;</pre></div><p>

</p>
<p>Having established the disposition values in this way, a set of actions could be defined that return 
                    a disposition of "allocate" or "activate" for a label consisting exclusively of variants with disposition
                    "preferred" for example. (For details on how to define actions based
                    on variant dispositions see <a class='info' href='#actions'>Section&nbsp;7<span> (</span><span class='info'>The action Element</span><span>)</span></a>.)
</p>
<p>
                    In general, using reflexive variant mappings in this manner, makes it possible to calculate disposition
                    values using a uniform approach for all labels, whether they consist of mapped variant code point,
                    original code points, or a mixture of both. In particular, the disposition values for two otherwise identical labels
                    may differ based on which variant mappings were executed in order to generate each of them.
                    (For details on how to generate variants and evaluate dispositions, see <a class='info' href='#processing'>Section&nbsp;8<span> (</span><span class='info'>Processing a Label Against an LGR</span><span>)</span></a>.)
                    
</p>
<a name="when"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.6"></a><h3>5.2.6.&nbsp;
Conditional Variants</h3>

<p>Fundamentally, variants are mappings between two sequences of code points. However, in some
                        instances for a variant relationship to exist, some context external to the code point sequence
                        must be considered. For example, a positional context may determine whether two
                        code point sequences are variants of each other. 
</p>
<p>An example of that are the Arabic code points, which can
                        have different forms based on position, with some code points sharing forms, thus making them
                        variants in the positions corresponding to those forms. Such positional context cannot be solely
                        derived from the code point by itself, as the code point would be the same for the various forms.
                    
</p>
<p>To specify a conditional variant relationship the optional "when" attribute is used. The variant
                        relationship exists when the condition in the "when" attribute is satisfied. A "not-when"
                        attribute may be used for conditions that must not be satisfied. The value of each "when" or
                        "not-when" attributes is a parameterized context rule as described below in <a class='info' href='#parameterized_context_rule'>Section&nbsp;6.4<span> (</span><span class='info'>Parameterized Context or When Rules</span><span>)</span></a>.
                    
</p>
<p>Assuming the "rules" element contains suitably defined rules for "arabic-isolated" and
                        "arabic-final", the following example shows how to mark ARABIC LETTER ALEF WITH WAVY HAMZA BELOW
                        (U+0673) as a variant of ARABIC LETTER ALEF WITH HAMZA BELOW (U+0625), but only when it appears
                        in its isolated or final forms:
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="0625"&gt;
        &lt;var cp="0673" when="arabic-isolated"/&gt;
        &lt;var cp="0673" when="arabic-final"/&gt;
    &lt;/char&gt;
</pre></div><p>

</p>
<p>Only a single "when" or "not-when" attribute can be applied to any "var"
                        element, however, multiple "var" elements using the same
                        mapping, but different "when" or "not-when" attributes may be specified. 
                    
</p>
<p>While currently Arabic is the only script known for which such conditional variants are defined.
                        there are other scripts, such as Mongolian, which share the concept of positional forms. By
                        requiring explicit definitions for these rules, this mechanism can easily handle any additional
                        types of conditional variants that are required.
                    
</p>
<p>As described in
                        <a class='info' href='#sequences'>Section&nbsp;5.1<span> (</span><span class='info'>Sequences</span><span>)</span></a>
                        a "when" or "not-when" attribute may also be specified to any "char" element in the data section
                        to define required or prohibited contextual conditions under which a code point is valid.
                    
</p>
<a name="comment"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.7"></a><h3>5.2.7.&nbsp;
The comment Attribute</h3>

<p>Any "char", "range" or "variant" element in the data section may contain an optional "comment" attribute. The
                        contents of a comment attribute are free-form plain text. Comments are ignored in machine
                        processing of the table. Comment attributes may also be placed on all elements in the
                        "rules" section of the document, such as actions and match operators, such as literals ("char"), as well as definitions
                        of classes and rules, but not on child elements of the "class" element. Finally, in the metadata, only the "version"
                        and "reference" elements may have comment attributes (to match the syntax in
                        <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a>).
                    
</p>
<a name="tagging"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Code Point Tagging</h3>

<p>Typically, LGRs are used to explicitly designate allowable code points, where any label that contains a code
                    point not explicitly listed in the LGR is considered an ineligible label according to the
                    ruleset.
                
</p>
<p>For more complex registry rules, there may be a need to discern on or more subsets code points. This
                    can be accomplished by applying an optional "tag" attribute to char or range elements, thereby defining character 
                    classes (see <a class='info' href='#tag_based_classes'>Section&nbsp;6.2.1<span> (</span><span class='info'>Tag-based Classes</span><span>)</span></a>) which can then be used in whole label evaluation
                    rules (see <a class='info' href='#match_operators'>Section&nbsp;6.3.2<span> (</span><span class='info'>The Match Operators</span><span>)</span></a>). Tag attributes may be of any value, and multiple values are
                    separated by space. Code point sequences not being proper members of a set of code points, a "tag"  attribute
                    MUST NOT be present in a char element defining a code point sequence.
                
</p>
<p>A simple example of tag use would be to label preferred code points (as in <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a>) 
                   by adding "preferred" to the tag, and then using a rule such as shown in  <a class='info' href='#rule'>Section&nbsp;6.3.1<span> (</span><span class='info'>The rule Element</span><span>)</span></a> to single
                   out labels for allocation that consist entirely of such preferred code points. For a variety of reasons, actual
                   tables use a different approach.
                
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Whole Label and Context Evaluation</h3>

<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Basic Concepts</h3>

<p>The code points in a label sometimes need to satisfy context-based rules, for example for the label
                    to be considered valid, or to satisfy the context for a variant mapping (see the description of the
                    "when" attribute in <a class='info' href='#parameterized_context_rule'>Section&nbsp;6.4<span> (</span><span class='info'>Parameterized Context or When Rules</span><span>)</span></a>).
                
</p>
<p>A Whole Label Evaluation rule (WLE) is applied to the whole label. It is used to validate both
                    original labels and variant labels computed from them using a permutation over all applicable
                    variant mappings. A conditional context rules is a specialized
                    form of WLE specific to the context around a single code point or code point sequence. For example,
                    if a rule is referenced in the "when" attribute of a variant mapping it is used to describe the
                    conditional context under which the particular variant mapping is defined to exist.
                
</p>
<p>Each rule is defined in a "rule" element. A rule may contain the following as child elements:
                
</p>
<p>
                    </p>
<ul class="text">
<li>literal code points or code point sequences
</li>
<li>character classes, which define sets of code points to be used for context comparisons;
                        
</li>
<li>nested rules; and
</li>
<li>context operators, which define when character classes and literals may appear; and
</li>
</ul><p>
                    
</p>
<p>
                    Collectively, these are called match operators and are listed in <a class='info' href='#match_operators'>Section&nbsp;6.3.2<span> (</span><span class='info'>The Match Operators</span><span>)</span></a>.
                
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Character Classes</h3>

<p>Character classes are sets of characters that often share a particular property. While they function 
                like sets in every way, even supporting the usual set operators, they are called character classes here
                in a nod to the use of that term in regular expression syntax. (This also avoids confusion with the term
                "character set" in the sense of character encoding.)
</p>
<p>Character classes (or sets) can be specified in several ways:
                
</p>
<p>
                    </p>
<ol class="text">
<li>by defining the set via matching a tag in the code point data. All characters with the
                            same tag attribute are part of the same class.
                        
</li>
<li>by referencing one of the Unicode character properties defined in the Unicode Character
                            Database<a class='info' href='#UAX42'>[UAX42]<span> (</span><span class='info'>Unicode Consortium, &ldquo;Unicode Character Database in XML,&rdquo; .</span><span>)</span></a>;
                        
</li>
<li>by explicitly listing all the code points in the class; or
</li>
<li>by defining the class as a set combination of any number of other classes.
                        
</li>
</ol><p>
                
</p>
<p>A character class has an optional "name" attribute, consisting of a single identifier not containing
                    spaces. If it is omitted, the class is anonymous and exists only inside the rule or combined class
                    where it is defined. A named character class is defined independently and can be referenced by name
                    from within any rules or as part of other character class definitions.
                
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;class name="example" comment="an example class definition"&gt;
        &lt;char cp="0061" /&gt;
        &lt;char cp="4E00" /&gt;
    &lt;/class&gt;
    ...
    &lt;rule&gt;
        &lt;class by-ref="example" /&gt;
    &lt;/rule&gt;
</pre></div><p>

</p>
<p>An empty "class" element with a "by-ref" attribute is a reference to an existing named class. A
				"by-ref" attribute is mutually exclusive with "name", "from-tag", "property" or "ref" attributes.
                
</p>
<a name="tag_based_classes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.1"></a><h3>6.2.1.&nbsp;
Tag-based Classes</h3>

<p>The char element may contain a tag attribute that consists of one or more space separated
                        tag values, for example:
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="0061" tag="letter lower"/&gt;
    &lt;char cp="4E00" tag="letter"/&gt;
</pre></div><p>

</p>
<p>This defines two tags for use with code point U+0061, the tag "letter" and the tag "lower".
                        Use
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;class name="letter" from-tag="letter"&gt;
    &lt;class name="lower" from-tag="lower" /&gt;
</pre></div><p>

</p>
<p>to define two named character classes, "letter" and "lower", containing all code points with the respective tags, 
                        the first with 0061 and 4E00 as elements and the latter with 0061, but not 4E00 as an element. The name attribute
						may be omitted for an anonymous in-place definition of a nested, tag-based class. The "from-tag" attribute is
						mutually exclusive to the "by-ref" attribute.
						
</p>
<p>Tag values are formally free-form, except they cannot contain spaces. However, best practice would be to follow
						the identifier syntax, perhaps with the addition of a few punctuation symbols, such as colon.
</p>
<p>If the document contains no "char" or "range" elements with a corresponding tag, the character class
						represents the empty set. This is valid, to allow a common "rules" element to be shared across files. However, 
						it is RECOMMENDED that implementations allow for a warning to ensure that referring to an undefined tag
						in this way is intentional.
</p>
<a name="property"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.2"></a><h3>6.2.2.&nbsp;
Unicode Property-based Classes</h3>

<p>A class is defined in terms of Unicode properties by giving the Unicode property alias and the
                        property value or property value alias, separated by a colon.
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;class name="virama" property="ccc:9" /&gt;
</pre></div><p>

</p>
<p>The example above selects all code points for which the Unicode canonical combining class (ccc)
                        value is 9. This value of the ccc is assigned to all code points that encode viramas. The
                        string "ccc" is the short-alias for the canonical combining class, as defined in the Unicode
                        Character Database <a class='info' href='#UAX42'>[UAX42]<span> (</span><span class='info'>Unicode Consortium, &ldquo;Unicode Character Database in XML,&rdquo; .</span><span>)</span></a>. The use of the "property" attribute is mutually
						exclusive to the "by-ref" or "from-tag" attributes.
                    
</p>
<p>Unicode properties may, in principle, change between versions of the Unicode Standard. However,
                        the values assigned for a given version are fixed. If Unicode Properties are used, a 
                        Unicode version MUST be declared in the "unicode-version" element in the header. 
						(Note, some Unicode properties are by definition
                        stable across versions and do not change once assigned (see <a class='info' href='#Unicode-Stability'>[Unicode&#8209;Stability]<span> (</span><span class='info'>Unicode Consortium, &ldquo;Unicode Encoding Stability Policy, Property Value Stability,&rdquo; .</span><span>)</span></a>.)
                    
</p>
<p>If full support of all Unicode properties is not available, support for the following minimal 
					set of Unicode properties is RECOMMENDED: 
					</p>
<ul class="text">
<li>General Category (gc)
</li>
<li>Script (sc)
</li>
<li>Canonical Combining Class (ccc)
</li>
<li>Bidi Class (bc)
</li>
<li>Arabic Joining Type (jt)
</li>
<li>Indic Syllabic Category (InSC)
</li>
<li>Deprecated (Dep)
</li>
</ul><p>
					The short name for each property is given in parentheses.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.3"></a><h3>6.2.3.&nbsp;
Explicitly Declared Classes</h3>

<p>A class of code points may also be declared by listing the code points that are a member of the
                        class. This is useful when tagging cannot be used because code points are not listed
                        individually as part of the eligible set of code points for the given LGR, for example because
                        they only occur in code point sequences.
                    
</p>
<p>To define a class in terms of an explicit list of code points:
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;class name="abc"&gt;
        &lt;char cp="0061"/&gt;
        &lt;char cp="0062"/&gt;
        &lt;char cp="0063"/&gt;
   &lt;/class&gt;
</pre></div><p>

</p>
<p>This defines a class named "abc" containing the code points for characters "a", "b" and "c".
                        The ordering of the code points is not material, but it is RECOMMENDED to list them in ascending
                        order.
                    
</p>
<p>Range operators may also be used to represent any series of consecutive code points. The same
                        declaration can be made as follows:
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;class name="abc"&gt;
        &lt;range first-cp="0061" last-cp="0063"/&gt;
    &lt;/class&gt;
</pre></div><p>

</p>
<p>Range and code point declarations can be freely intermixed. A shorthand notation exists where
                        code points are directly represented by space separated hexadecimal values, and ranges are
                        represented by a start and end value separated by a hyphen. The element:
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;class name="abc"&gt;0061 0062-0063&lt;/class&gt;
</pre></div><p>

</p>
<p>would be a more streamlined expression of the same class using the shorthand notation.
</p>
<p>A class element either contains any combination of char and range elements and no other elements,
                    or a text node with the    shorthand notation. No attributes are permitted on char and range elements when
					used as child elements of a class element.
</p>
<a name="combined_classes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.4"></a><h3>6.2.4.&nbsp;
Combined Classes</h3>

<p>Classes may be combined using operators for set complement, union, intersection, difference
                        and symmetric difference (exclusive-or). Because classes fundamentally function like sets, the union of 
                        several character classes is itself a class, for example.
                    
</p>
<p>
                        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+-------------------+---------------------------------------------+
| Logical Operation | Example                                     |
+-------------------+---------------------------------------------+
| Complement        | &lt;complement&gt;&lt;class by-ref="xxx"&gt;&lt;/complement&gt;|
+-------------------+---------------------------------------------+
| Union             | &lt;union&gt;                                     |
|                   |    &lt;class by-ref="class-1"/&gt;                |
|                   |    &lt;class by-ref="class-2"/&gt;                |
|                   |    &lt;class by-ref="class-3"/&gt;                |
|                   | &lt;/union&gt;                                    |
+-------------------+---------------------------------------------+
| Intersection      | &lt;intersection&gt;                              |
|                   |    &lt;class by-ref="class-1"/&gt;                |
|                   |    &lt;class by-ref="class-2"/&gt;                |
|                   | &lt;/intersection&gt;                             |
+-------------------+---------------------------------------------+
| Difference        | &lt;difference&gt;                                |
|                   |    &lt;class by-ref="class-1"/&gt;                |
|                   |    &lt;class by-ref="class-2"/&gt;                |
|                   | &lt;/difference&gt;                               |
+-------------------+---------------------------------------------+
| Symmetric         | &lt;symmetric-difference&gt;                      |
| Difference        |    &lt;class by-ref="class-1"/&gt;                |
|                   |    &lt;class by-ref="class-2"/&gt;                |
|                   | &lt;/symmetric-difference&gt;                     |
+-------------------+---------------------------------------------+
</pre></div><p>

                    
</p>
<p>The elements from this table may be arbitrarily nested inside each other, subject to the
                     following restriction: a "complement" element MUST contain precisely one "class" or one of the
                     operator elements, while  an "intersection", "symmetric-difference" or "difference" element MUST
                     contain precisely two, and a "union" element MUST contain two or more of these elements.
                    
</p>
<p>An anonymous combined class can be defined directly inside a rule or of the match
                    operator elements that allow child elements (see  <a class='info' href='#match_operators'>Section&nbsp;6.3.2<span> (</span><span class='info'>The Match Operators</span><span>)</span></a>)
                                        by using the set combination as the outer element.
                    
</p>
<p>
                        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;rule&gt;
        &lt;union&gt;
            &lt;class by-ref="xxx"/&gt;
            &lt;class by-ref="yyy"/&gt;
        &lt;/union&gt;
    &lt;/rule&gt;
</pre></div><p>

                    
</p>
<p>The example shows the definition of an anonymous combined class that represents the union of classes "xxx" and "yyy".
                    There is no need to wrap this union inside another class element, and, in fact, set combination elements
                    MUST NOT be nested inside a "class" element.  
</p>
<p>Lastly, to create a named combined class that can be
                        referenced in other classes or in rules as &lt;class by-ref="xxxyyy"/&gt;, add a "name" attribute to
                        the set combination element, for example &lt;union name="xxxyyy" /&gt; and place it at the
                        top level below the "rules" element.
</p>
<p>
                        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre> &lt;rules&gt;
    &lt;union class name="xxxyyy"&gt;
        &lt;class by-ref="xxx"/&gt;
        &lt;class by-ref="yyy"/&gt;
    &lt;/union&gt;
      . . .
  &lt;/ rules&gt;
</pre></div><p>

                    
</p>
<p>Because (as for sets) a combination of classes is itself a class, no matter how a class is created, a reference 
                    to it always uses the "class" element. That is, a named class is always referenced via an empty "class" element
                    using the "by-ref" attribute containing the name of the class to be referenced. 
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Whole Label and Context Rules</h3>

<p>Each rule is comprised of a series of matching operators that must be satisfied in order to determine
                    whether a label meets a given condition. Rules may reference other rules or character classes
                    defined elsewhere in the table.
                
</p>
<a name="rule"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.1"></a><h3>6.3.1.&nbsp;
The rule Element</h3>

<p>A matching rule is defined by a "rule" element, the child elements of which are one of the match operators
                    from the table below. In evaluating a rule, each child element is matched in order. Rule elements may be nested.
                    
</p>
<p>Rules may optionally be named using a "name" attribute containing a single identifier string with
                        no spaces. A named rule may be incorporated into another rule by reference. If the name attribute is omitted,
                        the rule is anonymous and may not be incorporated by reference into another rule or referenced by an action
                        or "when" attribute.
                    
</p>
<p>A simple rule to match a label where all characters are members of the class "preferred":
</p>
<p>
                        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;rule name="preferred"&gt;
        &lt;start /&gt;
        &lt;class by-ref="preferred" count="1+"/&gt;
        &lt;end /&gt;
    &lt;/rule&gt;</pre></div><p>

                    
</p>
<p>Rules are paired with explicit and implied actions, triggering these actions when a rule matches
                        a label. For example, a simple explicit action for the rule shown above would be:
                    
</p>
<p>
                        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;action disp="allocate" match="preferred" /&gt;</pre></div><p>

                    
</p>
<p>which has the effect of setting the policy disposition for a label made up entirely of
                        "preferred" code points to "allocate". Explicit actions are further discussed in
                        <a class='info' href='#actions'>Section&nbsp;7<span> (</span><span class='info'>The action Element</span><span>)</span></a>
                        and the use of rules in conditional contexts for implied actions is discussed in
                        <a class='info' href='#when'>Section&nbsp;5.2.6<span> (</span><span class='info'>Conditional Variants</span><span>)</span></a>
                        and
                        <a class='info' href='#implied_actions'>Section&nbsp;7.5<span> (</span><span class='info'>Implied Actions</span><span>)</span></a>.
                    
</p>
<a name="match_operators"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.2"></a><h3>6.3.2.&nbsp;
The Match Operators</h3>

<p>The child elements of a rule are a series of match operators, which are listed here by type and name and with a basic example or two.
</p>
<p>
                        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+------------+-------------+------------------------------------+
| Type       | Operator    | Examples                           |
+------------+-------------+------------------------------------+
| logical    | any         | &lt;any /&gt;                            |
|            +-------------+------------------------------------+
|            | choice      | &lt;choice&gt;                           |
|            |             |  &lt;rule by-ref="alternative1"/&gt;     |
|            |             |  &lt;rule by-ref="alternative2"/&gt;     |
|            |             | &lt;/choice&gt;                          |
+--------------------------+------------------------------------+
| positional | start       | &lt;start /&gt;                          |
|            +-------------+------------------------------------+
|            | end         | &lt;end /&gt;                            |
+--------------------------+------------------------------------+
| literal    | char        | &lt;char cp="0061 0062 0063" /&gt;       |
+--------------------------+------------------------------------+
| set        | class       | &lt;class by-ref="class1" /&gt;          |
|            |             | &lt;class&gt;0061 0064-0065&lt;/class&gt;      |
+--------------------------+------------------------------------+
| group      | rule        | &lt;rule by-ref="rule1" /&gt;            |
|            |             | &lt;rule&gt;&lt;any /&gt;&lt;rule /&gt;              |
+--------------------------+------------------------------------+
| contextual | anchor      | &lt;anchor /&gt;                         |
|            +-------------+------------------------------------+
|            | look-ahead  | &lt;look-ahead&gt;&lt;any /&gt;&lt;/look-ahead&gt;   |
|            +-------------+------------------------------------+
|            | look-behind | &lt;look-behind&gt;&lt;any /&gt;&lt;/look-behind&gt; |
+--------------------------+------------------------------------+
</pre></div><p>

                    
</p>
<p>Any element defining an anonymous class can be used as a match operator,  including any of the set combination operators
                    (see <a class='info' href='#combined_classes'>Section&nbsp;6.2.4<span> (</span><span class='info'>Combined Classes</span><span>)</span></a>) as well as references to a named classes.
</p>
<p>All match operators shown as empty elements in the Examples
                    column of the table above do not support child elements of their own; otherwise match operators may be nested.
                    In particular, anonymous rule elements can be used for grouping.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.3"></a><h3>6.3.3.&nbsp;
The count Attribute</h3>

<p>The optional count attribute specifies the minimally required or maximal permitted number of
                        times a match operator is used to match input. If the count attribute is</p>
<blockquote class="text"><dl>
<dt>n or n:n</dt>
<dd>
                        the match operator matches the input exactly n times, where n is 1 or greater.
                        
</dd>
<dt>n+</dt>
<dd>
                        the match operator matches the input at least n times, where n is 0 or greater.
                        
</dd>
<dt>n:m</dt>
<dd>
                        the match operator matches the input at least n times where n is 0 or greater, but matches the input
                        up to m times in total, where m > n.
                        
</dd>
<dt>missing</dt>
<dd>
                        the match operator matches the input exactly once.
                        
</dd>
</dl></blockquote><p>
                        In matching, greedy evaluation is used in the sense defined for regular expressions:  beyond the required
                        number or times, the input is matched as many times as possible, but not so often as to prevent a match
                        of the remainder of the rule. 
</p>
<p>The count attribute MUST NOT be applied to match operators of type "start", "end", "anchor", "look-ahead"
                        and "look-behind" or to any operators, such as "rule" or "choice" that contain them, whether the latter are declared in place or used by reference.  The count attribute may be applied to "class" and "rule" elements only if they do not have a "name" attribute,
                        that is to anonymous rules and classes or any invocation of predefined rules or classes by reference.
                        
</p>
<p>The optional count attribute MAY be applied to match operators of type "any", "char" and "class", as well as to
						match operators "choice" and "rule", as long as they contain none of the operators "start", "end", "anchor", "look-ahead"
                        and "look-behind" as direct or indirect child elements. The same requirement applies recursively to any "rule"
						element referenced inside a "choice" or "rule" with a count attribute.  The count attribute is mutually exclusive 
						to the "name" attribute.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.4"></a><h3>6.3.4.&nbsp;
The name and by-ref Attributes</h3>

<p>Rules (and classes) declared as immediate child elements of the "rules" element MUST be named 
						using a "name" attribute, all other instances of rules and classes MUST NOT be named. 
						Named rules and classes can be nested inside other match
                        operators by reference.
</p>
<p>To reference a named rule (or class) use a rule or class element with an optional "by-ref"
                        attribute containing the name of the referenced element. It is an error to reference a rule or class for which the
                        definition has not been seen. 
						The use of the "by-ref" for a rule or class element is mutually exclusive with the use of  the "name" attribute, 
						as well as with the presence of any child elements.
                        
</p>
<p>Here's an example of a rule requiring that all labels be letters (optionally followed by
                            combining marks)
                            and possibly digits. The example shows rules and classes referenced by name.
                        
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;class name="letter" property="gc:L"/&gt;
    &lt;class name="combining-mark" property="gc:M"/&gt;
    &lt;class name="digit" property="gc:Nd"&gt;
    &lt;rule name="letter-grapheme"&gt;
       &lt;class by-ref="letter" count="1+"/&gt;
       &lt;class by-ref="combining-mark" count="0+"/&gt;
    &lt;/rule&gt;
    &lt;rule name="leading-letter" &gt;
       &lt;start /&gt;
       &lt;rule by-ref="letter-grapheme" count="1"/&gt;
       &lt;choice count="0+"&gt;
           &lt;rule by-ref="letter-grapheme" count="0+"/&gt;
           &lt;class by-ref="digit" count="0+"/&gt;
       &lt;/choice&gt;
       &lt;end /&gt;
    &lt;/rule&gt;</pre></div><p>

</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.5"></a><h3>6.3.5.&nbsp;
The choice Element</h3>

<p>For cases where several alternates could be chosen, the "choice" element can
                            encode a list of choices:
                        
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;rule name="ldh"&gt;
       &lt;choice count="1+"&gt;
           &lt;class by-ref="letters"/&gt;
           &lt;class by-ref="digits"/&gt;
           &lt;char cp="002D" comment="literal HYPHEN"/&gt;
       &lt;/choice&gt;
    &lt;/rule&gt;</pre></div><p>

</p>
<p>Each child element of a "choice" represents one alternative. The first matching alternative
                            determines the match for the choice element. To express a choice where one alternative
                            consists of a sequence of elements, they can be wrapped in an anonymous rule.
                        
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.6"></a><h3>6.3.6.&nbsp;
Literal Code Point Sequences</h3>

<p>A literal code point sequence matches a single code point or a sequence. It is defined by a
                            "char" element, with the code point or sequence to be matched given by the "cp" attribute.
                            When used as a literal, a "char" element may contain a "count" in addition to the "cp"
                            attribute and optional "comment" or "ref" attributes. No other attributes or child elements.
							are permitted.
                        
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.7"></a><h3>6.3.7.&nbsp;
The any Element</h3>

<p>The "any" element matches any single code point. It may have a "count" attribute. For an
                            example see
                            <a class='info' href='#IDNA2008-example'>Section&nbsp;6.3.9<span> (</span><span class='info'>Example rule from IDNA2008</span><span>)</span></a>
                        
</p>
<p>Unlike a literal, the "any" element" may not have a "ref" attribute.
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.8"></a><h3>6.3.8.&nbsp;
The start and end Elements</h3>

<p>To match the beginning or end of a label, use the "start" or "end" element.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;rule name="empty-label"&gt;
        &lt;start/&gt;
        &lt;end/&gt;
    &lt;/rule&gt;</pre></div><p>

</p>
<p>Whole Label Evaluation Rules in principle always apply to the entire label, but in practice,
                             many rules do not need to cover the entire label. For example, to express a requirement of
                             not starting a label with a digit, the rule needs to describe only the initial part of a label.
                        
</p>
<p>Start and end elements each occur at most once in a rule, except if nested inside a "choice" element in
                            such a way that in matching each alternative at most one occurrence of each is encountered. Otherwise,
                            the result is undefined; as is any case where start and end elements not encountered as first or last element, respectively, in 
							matching a rule. Start and end elements do not have a "count" or any other attribute. If 
						    any enclosing match operator has a count attribute the results are undefined. 
</p>
<a name="IDNA2008-example"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3.9"></a><h3>6.3.9.&nbsp;
Example rule from IDNA2008</h3>

<p>This sections shows an example of the whole label evaluation rule from<a class='info' href='#RFC5892'>[RFC5892]<span> (</span><span class='info'>Faltstrom, P., &ldquo;The Unicode Code Points and Internationalized Domain Names for Applications (IDNA),&rdquo; August&nbsp;2010.</span><span>)</span></a>forbidding the mixture of the Arabic-Indic and extended Arabic-Indic
                            digits in the same label.
                        
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;data&gt;
       &lt;range first-cp="0660" last-cp="0669" not-when="mixed-digits"
              tag="arabic-indic-digits" /&gt;
       &lt;range first-cp="06F0" last-cp="06F9" not-when="mixed-digits"
              tag="extended-arabic-indic-digits" /&gt;
    &lt;/data&gt;
    &lt;rules&gt;
       &lt;rule name="mixed-digits"&gt;
          &lt;choice&gt;
            &lt;rule&gt;
                &lt;class by-ref="arabic-indic-digits"/&gt;
                &lt;any count="0+"/&gt;
                &lt;class by-ref="extended-arabic-indic-digits"/&gt;
             &lt;/rule&gt;
             &lt;rule&gt;
                &lt;class by-ref="extended-arabic-indic-digits"/&gt;
                &lt;any count="0+"/&gt;
                &lt;class by-ref="arabic-indic-digits"/&gt;
             &lt;/rule&gt;
          &lt;/choice&gt;
       &lt;/rule&gt;
    &lt;/rules&gt;</pre></div><p>

</p>
<p>The preceding example also demonstrates several instances of the use of anonymous rules for
                            grouping.
                        
</p>
<a name="parameterized_context_rule"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Parameterized Context or When Rules</h3>

<p>A special type of rule provides a context for evaluating the validity of a code point or variant
                        mapping. This rule is invoked by the "when" attribute described in <a class='info' href='#when'>Section&nbsp;5.2.6<span> (</span><span class='info'>Conditional Variants</span><span>)</span></a>. An  
                        action implied by a context rule always has a disposition of "invalid" whenever the rule is not
                        matched (see <a class='info' href='#implied_actions'>Section&nbsp;7.5<span> (</span><span class='info'>Implied Actions</span><span>)</span></a>). Conversely, a "not-when" attribute results 
                        in a disposition    of invalid whenever the rule is matched.
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4.1"></a><h3>6.4.1.&nbsp;
The anchor Element</h3>

<p>Such parameterized context or "When Rules" may contain a special place holder represented by an "anchor" element.
                        As each When Rule is evaluated, the "anchor" element is replaced by a literal corresponding to the "cp" attribute
                        of the element containing the "when" (or "not-when") attribute. The match to the
                        "anchor" element must be at the same position in the label as the code point or variant mapping
                        triggering the When Rule.
                    
</p>
<p>For example, the Greek lower numeral sign is invalid if not immediately preceding a character in
                        the Greek script. This is most naturally addressed with a When Rule using look-ahead:
                    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="0375" when="preceding-greek"/&gt;
    ...
    &lt;class name="greek-script" property="sc:Grek"/&gt;
    &lt;rule name="preceding-greek"&gt;
        &lt;anchor/&gt;
        &lt;look-ahead&gt;
            &lt;class by-ref="greek-script"/&gt;
        &lt;/look-ahead&gt;
    &lt;/rule&gt;</pre></div><p>

</p>
<p>In evaluating this rule, the "anchor" element is treated as if it was replaced by a literal
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="0375"/&gt;</pre></div><p>

</p>
<p>but only the instance of U+0375 at the given position is evaluated. If a label had two instances of
                    U+0375 with the first one matching the rule and the second not, then evaluating the When Rule MUST
                    succeed for the first and fail for the second instance.
                    
</p>
<p>Unlike other rules,  When Rules containing an "anchor" element MUST only be invoked via the "when" or 
                    "not-when" attributes on code points or variants; otherwise their "anchor" elements cannot
                    be evaluated. However, it is possible to invoke rules not containing an "anchor" element from a
                    "when" or "not-when" attribute. (See <a class='info' href='#omitting'>Section&nbsp;6.4.3<span> (</span><span class='info'>Omitting the anchor Element</span><span>)</span></a>)
                    
</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4.2"></a><h3>6.4.2.&nbsp;
The look-behind and look-ahead Elements</h3>

<p>Context rules use the "look-behind" and "look-ahead" elements to define context before and
                            after the code point sequence matched by the "anchor" element. If the "anchor" element is
                             omitted, neither the "look-behind" nor the "look-ahead" element may be present.
                        
</p>
<p>Here is an example of a rule that defines an "initial" context for an Arabic code point:
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;class name="transparent" property="jt:T"/&gt;
    &lt;class name="right-joining" property="jt:R"/&gt;
    &lt;class name="left-joining" property="jt:L"/&gt;
    &lt;class name="dual-joining" property="jt:D"/&gt;
    &lt;class name="non-joining" property="jt:U"/&gt;
    &lt;rule name="Arabic-initial"&gt;
      &lt;look-behind&gt;
        &lt;choice&gt;
          &lt;start/&gt;
          &lt;rule&gt;
            &lt;class by-ref="transparent" count="0+"/&gt;
            &lt;class by-ref="non-joining"/&gt;
          &lt;/rule&gt;
        &lt;/choice&gt;
      &lt;/look-behind&gt;
      &lt;anchor/&gt;
      &lt;look-ahead&gt;
        &lt;class by-ref="transparent" count="0+" /&gt;
        &lt;choice&gt;
          &lt;class by-ref="right-joining" /&gt;
          &lt;class by-ref="dual-joining" /&gt;
        &lt;/choice&gt;
      &lt;/look-ahead&gt;
    &lt;/rule&gt;</pre></div><p>

</p>
<p>A "when rule" contains any combination of "look-behind" , "anchor" and "look-ahead" elements in
                            that order. Each of these elements occurs at most once, except if nested inside a "choice" element in
                            such a way that in matching each alternative at most one occurrence of each is encountered. Otherwise,
                            the result is undefined. None of these elements takes a "count" attribute, nor does any enclosing
							match operator. Otherwise, the result is undefined.
                            If a context rule contains a look-ahead or look-behind element, it MUST contain an "anchor" element. 
							If, because of a choice element, a required anchor is not actually encountered, the results are undefined.
                        
</p>
<a name="omitting"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4.3"></a><h3>6.4.3.&nbsp;
Omitting the anchor Element</h3>

<p>
                            If the "anchor" element is omitted, the evaluation of the context rule is not tied to the
                            position of the code point or sequence associated with the "when" attribute.
                        
</p>
<p>Katakana middle dot is invalid in any label not containing at least one Japanese character
                            anywhere in the label. Because this requirement is independent of the position of the middle
                            dot, the rule does not require an "anchor" element.
                        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="30FB" when="japanese-in-label"/&gt;
    &lt;rule name="japanese-in-label"&gt;
        &lt;union&gt;
            &lt;class property="sc:Hani"/&gt;
            &lt;class property="sc:Kata"/&gt;
            &lt;class property="sc:Hira"/&gt;
        &lt;/union&gt;
    &lt;/rule&gt;</pre></div>
<p>The Katakana middle dot is used only with Han, Katakana or Hiragana. The corresponding When Rule requires
                            that at least one code point in the label is in one of these scripts, but the position of that code point is independent
							of the location of the middle dot and no anchor therefore required. (Note that the Katakana middle dot itself is of 
							script Common).
                        
</p>
<a name="actions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
The action Element</h3>

<p>The purpose of a rule is to trigger a specific action. Often, the action simply results in blocking or invalidating a
                    label that does not match a rule. An example of an action invalidating a label because it does not match a rule 
                    named "leading-letter" is as follows:
                
</p>
<p>
                    </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>   &lt;action disp="invalid" not-match="leading-letter"/&gt;</pre></div><p>

                
</p>
<p>If an action is to be triggered on matching a rule, a "match" attribute is used instead.   Actions are 
                evaluated in the order that they appear in the XML file, Once an action
                     is triggered by a label, the disposition defined in the "disp" attribute is assigned
                     to the label and no other actions are evaluated for that label. 
</p>
<a name="match_attribute"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
The match and not-match Attributes</h3>

<p>A "match" or "not-match" attribute specify a rule that must be matched or not matched
                as a condition for triggering an action. Only a single rule
                     may be named as the value of a "match" or "not-match" attribute. Because rules may be composed
                     of other rules, this restriction to a single attribute value does not impose any limitation on the contexts that can
                     trigger an action.
</p>
<p>An action may contain a "match" or a "not-match" attribute, but not both. An action without any
                attributes is triggered by all labels unconditionally.  For a very simple LGR, the following action would
                allocate all labels that match the repertoire:
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;action disp="allocate" /&gt;</pre></div><p>

</p>
<p>Since rules are evaluated for all labels, whether they are the original label or computed by permuting
                the defined and valid variant mappings for the label's code points, actions based
                on matching or not matching a rule may be triggered for both original and variant labels, but they
                the rules are not affected by the disposition attributes of the variant mappings. To trigger any actions base on
                these dispositions requires the use additional optional attributes for actions described next.
                
</p>
<a name="variants_actions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Actions matching Variant Dispositions</h3>

<a name="variant_triggers"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.1"></a><h3>7.2.1.&nbsp;
Variant Disposition triggers</h3>

<p>An action may contain one of the optional attributes "any-variant", "all-variants" or "only-variants" defining triggers
                    based on variant dispositions. The permitted value
                    for these attributes consists of one or more variant disposition values, separated by space.  When a variant label
                    is generated, these disposition values are compared to the disposition values on the variant mappings
                    used to generate the particular variant label. 
</p>
<p>Any single match may trigger an action that contains an "any-variant" attribute, while for an "all-variants",
                    "only-variants" attribute, the dispositions for all variant code points must match one or several of the
                    dispositions specified in the attribute value to trigger the action. An "only-variants" attribute will trigger
                    the action only if the variant label    contains no original code points other than those with a reflexive mapping (see 
                    <a class='info' href='#reflexive_mapping'>Section&nbsp;5.2.5<span> (</span><span class='info'>Variants with Reflexive Mapping</span><span>)</span></a>).
</p>
<p>One of these variant disposition triggers may be used by itself or in conjunction with an attribute matching or
                    not-matching a rule. If variant triggers and rule-matching triggers are used together, the label MUST "match" or respectively
                     "not-match" the specified rule, AND satisfy the conditions on the disposition values given by the "any-variant",
                     "all-variants", or "only-variants" attribute.
                
</p>
<a name="rfc3743_example"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.2"></a><h3>7.2.2.&nbsp;
Example for RFC3743-style Tables</h3>

<p>This section gives an example of using variant disposition triggers, combined with variants with reflexive
                 mappings <a class='info' href='#reflexive_mapping'>Section&nbsp;5.2.5<span> (</span><span class='info'>Variants with Reflexive Mapping</span><span>)</span></a> to achieve LGRs that implement tables like those defined
                 according to <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a> where the l is to allow only variants that consist entirely of simplified or
                 traditional variants, in addition to the original label. 
</p>
<p>Assuming an LGR where all variants have been given suitable "disp" attributes
                 of "block", "simplified", "traditional", or "both", similar to the one in <a class='info' href='#translate_rfc3743'>Appendix&nbsp;B<span> (</span><span class='info'>How to Translate RFC 3743 based Tables into the XML Format</span><span>)</span></a>.
                    Given such an LGR, the following example actions evaluate the disposition for the variant label:
                
</p>
<p>
                    </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;action disp="block" any-variant="block" /&gt;
    &lt;action disp="allocate" only-variants="simplified both" /&gt;
    &lt;action disp="allocate" only-variants="traditional both" /&gt;
    &lt;action disp="block" all-variants="simplified traditional " /&gt;
    &lt;action disp="allocate" /&gt;</pre></div><p>

                
</p>
<p>The first action matches any variant label for which at least one of the code point variants carries
                    the disposition "block". The second matches any variant label for which all of the code point
                    variants carry the disposition "simplified" or "both", in other words an all-simplified label. The third matches any
                     label for which all
                    variants carry the disposition "traditional" or "both", or all traditional. These two actions are not triggered by any
                    variant labels containing some original code points, unless the code point has a variant defined with
                    a reflexive mapping (<a class='info' href='#reflexive_mapping'>Section&nbsp;5.2.5<span> (</span><span class='info'>Variants with Reflexive Mapping</span><span>)</span></a>). 
</p>
<p>The final two actions rely on the fact that actions are evaluated in sequence, and that the first
                    action triggered also defines the final disposition for a variant label (see <a class='info' href='#precedence'>Section&nbsp;7.4<span> (</span><span class='info'>Precedence</span><span>)</span></a>).
                    They further rely on the assumption that the only variants with disposition "both" are also identity 
                    variants.
</p>
<p>
                     Given these assumptions, any remaining simplified or traditional
                    variants must then be part of a mixed label, and so are blocked; all labels surviving to the last action are
                    original code points only (that is the original label). 
</p>
<p>The assumption on identity mapping made above does not necessarily hold, so this scheme needs
                     some refinements to cover tables where it is violated. For a more complete example,
                     see <a class='info' href='#translate_rfc3743'>Appendix&nbsp;B<span> (</span><span class='info'>How to Translate RFC 3743 based Tables into the XML Format</span><span>)</span></a>.
</p>
<a name="recommended_disposition_values"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Recommended Disposition Values</h3>

<p>The precise nature of the policy action taken in response to a disposition and the name of the
                        corresponding "disp" attributes are only partially defined here. It is strongly
                        RECOMMENDED to use the following dispositions only with their conventional sense.
                    
</p>
<p>
                        </p>
<blockquote class="text"><dl>
<dt>invalid</dt>
<dd>The resulting string is not a valid label. This disposition may be
                                assigned implicitly, see <a class='info' href='#implied_actions'>Section&nbsp;7.5<span> (</span><span class='info'>Implied Actions</span><span>)</span></a>.  No variant labels should be
                                generated from a variant mapping with this disposition.
                            
</dd>
<dt>block</dt>
<dd>The resulting string is a valid label, but should be block from
                                registration. This would typically apply for a derived variant that has  
                                is undesirable as having no practical use or being confusingly similar to some other label.
                            
</dd>
<dt>allocate</dt>
<dd>The resulting string should be reserved for use by the same operator
                                of the origin string, but not automatically allocated for use.
                            
</dd>
<dt>activate</dt>
<dd>The resulting string should be activated for use. (This is the
                                typical default action if no dispositions are defined and is known as a "preferred" variant in
                                <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a>)
                            
</dd>
</dl></blockquote><p>
                    
</p>
<a name="precedence"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Precedence</h3>

<p>Actions are applied in the order of their appearance in the file. This defines their relative
                        precedence. The first action triggered by a label defines the disposition for that label.  To define 
                        a specific order of precedence list the actions in the desired order. The conventional order of precedence
                        for the actions defined in <a class='info' href='#recommended_disposition_values'>Section&nbsp;7.3<span> (</span><span class='info'>Recommended Disposition Values</span><span>)</span></a> is "invalid", "block", "allocate", "activate" .
                         This default precedence is used for the default actions defined in <a class='info' href='#default_actions'>Section&nbsp;7.6<span> (</span><span class='info'>Default Actions</span><span>)</span></a>.
                    
</p>
<a name="implied_actions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
Implied Actions</h3>

<p>The context rules on code points ("not-when" or "when" rules) carry an implied action with a disposition 
                    of "invalid" (not eligible). These rules are evaluated at the time the code points for a label or its variant labels are checked
                     for validity (see <a class='info' href='#processing'>Section&nbsp;8<span> (</span><span class='info'>Processing a Label Against an LGR</span><span>)</span></a>). In other words, they are evaluated before any of the
                        whole-label evaluation rules and
                        with higher precedence. The context rules for variant mappings are evaluated when variants are
                        generated and / or when variant tables are made symmetric and transitive. They have an implied
                        action with a disposition of "invalid" (undefined) which means a putative variant mapping does not exist whenever
                        the given context matches a "not-when" rule or fails to match a "when" rule specified for that 
                        mapping.
                    
</p>
<p>Note that such non-existing variant mapping is different from a blocked variant, which is a variant
                        code point mapping that exists but results in a label that may not be allocated. 
                    
</p>
<a name="default_actions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6"></a><h3>7.6.&nbsp;
Default Actions</h3>

<p>As described in <a class='info' href='#actions'>Section&nbsp;7<span> (</span><span class='info'>The action Element</span><span>)</span></a> any variant mapping may be given a "disp" attribute.
                       defining a disposition. An action containing an "any-variant" or "all-variants" attribute relates these
                       disposition values to a resulting disposition for the entire variant label. 
</p>
<p>If no actions are defined for the standard disposition values of "invalid", "block", "allocate" and "activate",
                        then the following default actions exist that are shown below in their default order of precedence (see <a class='info' href='#precedence'>Section&nbsp;7.4<span> (</span><span class='info'>Precedence</span><span>)</span></a>. This
                        default order for evaluating dispositions applies only to labels that triggered no explicitly defined actions
                        and which are therefore handled by default actions. Default actions have a lower order of precedence
                        than explicit actions (see <a class='info' href='#determining_dispositions'>Section&nbsp;8.3<span> (</span><span class='info'>Determining a  Disposition for a Label or variant Label</span><span>)</span></a>).
                    
</p>
<p>The default actions for variant labels are defined as follows:
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>   &lt;action disp="invalid" any-variant="invalid"/&gt;
    &lt;action disp="block" any-variant="block"/&gt;
    &lt;action disp="allocate" any-variant="allocate"/&gt;
    &lt;action disp="activate" all-variants="activate"/&gt;</pre></div><p>

</p>
<p>A final default action sets the disposition to "allocate" for any label matching the
                         repertoire for which no other action has been triggered (catch-all). 
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;action disp="allocate" /&gt;</pre></div><p>

</p>
<a name="processing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Processing a Label Against an LGR</h3>

<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Determining Eligibility for a Label</h3>

<p>In order to use a table to test a specific label for membership in the LGR, a consumer of the
                    LGR must iterate through each code point within a given U-label, and test that each code point is a
                    member of the LGR. If any code point is not a member of the LGR, it shall be deemed as not eligible
                    in accordance with the table.
                
</p>
<p>A code point is deemed a member of the table when it is listed with the "char" element, and all
                    necessary condition listed in "when" or "not-when" attributes are correctly satisfied.
                
</p>
<p>A label must also not trigger any action that results in a disposition of "invalid" or equivalent, otherwise
                it is deemed not eligible. (This step may need to be deferred, until variant code point dispositions have been determined)
</p>
<p>For LGRs that contain reflexive variant mappings (defined in <a class='info' href='#reflexive_mapping'>Section&nbsp;5.2.5<span> (</span><span class='info'>Variants with Reflexive Mapping</span><span>)</span></a>) the evaluation
                of dispositions must be deferred until variants are generated. In essence, tables that use this feature treat the original
                as the (identity) variant of itself. For such tables, the ordinary iteration over code points can at best be used to exclude
                a subset of invalid labels, effectively a pre-screening.
</p>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Determining Variants for a Label</h3>

<p>For a given eligible label, the set of variant labels is deemed to consist of each possible permutation of
                  original code points and "var"
                    elements, whereby all "when" and "not-when" attributes are correctly satisfied for each code point or var element
                    in the given permutation and all applicable whole label evaluation rules are satisfied as follows:
                    </p>
<ul class="text">
<li>Create each possible permutation of a label, by substituting each code point or code point
                            sequence in turn by any defined variant mapping (including any reflexive mappings).
                        
</li>
<li>Apply variant mappings with "when" or "not-when" attributes only if the conditions are
                            satisfied
                        
</li>
<li>Record each of the "disp" values on the variant mappings used in creating a given variant label; 
                        for any unmapped code point record the "disp" value of any variant with a reflexive mapping
                        (see <a class='info' href='#reflexive_mapping'>Section&nbsp;5.2.5<span> (</span><span class='info'>Variants with Reflexive Mapping</span><span>)</span></a>)
                        
</li>
<li>Determine the disposition for each variant label per <a class='info' href='#determining_dispositions'>Section&nbsp;8.3<span> (</span><span class='info'>Determining a  Disposition for a Label or variant Label</span><span>)</span></a>
                        
</li>
<li>
                        If the disposition is "invalid", remove the label from the set
                        
</li>
<li>
                        If final evaluation of the disposition for the original label per <a class='info' href='#determining_dispositions'>Section&nbsp;8.3<span> (</span><span class='info'>Determining a  Disposition for a Label or variant Label</span><span>)</span></a>
                        results in a disposition of "invalid"  or equivalent, remove all associated variant labels from the set.
</li>
</ul><p>
                
</p>
<a name="determining_dispositions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Determining a  Disposition for a Label or variant Label</h3>

<p>For a given label (variant or original), its disposition is determined by evaluating in order of their appearance
                    all actions for which the label or variant label satisfies the conditions.
                    </p>
<ul class="text">
<li>For any label, the disposition is given by the value of the "disp" attribute for the first action 
                        triggered by the label. An action is triggered, if
                        
<ul class="text">
<li>the label matches or doesn't match the whole label evaluation rule, given in the "match" or
                            "not-match" attribute respectively for that action;
</li>
<li>any or all of the recorded variant dispositions for a variant label match the dispositions
                            specified in an "any-variant" , "all-variants", or "only-variants" attribute, respectively, for that action,
                            and in case of "only-variants" the label contains only code points that are the target of applied variant
                            mappings; 
</li>
<li>the label matches or doesn't match the whole label evaluation rule, given in the "match" or
                            "not-match" attribute respectively for that action and any or all of the recorded variant dispositions for 
                            a variant label match the dispositions
                            specified in an "any-variant" , "all-variants", or "only-variants" attribute, respectively, for that action,
                            and in case of "only-variants" the label contains only code points that are the target of applied variant
                            mappings; or
</li>
<li>the action does not contain any "match", "not-match", "any-variant" or "all-variants" attributes (catch-all).
</li>
</ul>
                            
</li>
<li>For any remaining variant label, assign the variant label the disposition using the default actions
                        defined in <a class='info' href='#default_actions'>Section&nbsp;7.6<span> (</span><span class='info'>Default Actions</span><span>)</span></a>. For this step, variant dispositions outside the predefined
                        recommended set (see <a class='info' href='#recommended_disposition_values'>Section&nbsp;7.3<span> (</span><span class='info'>Recommended Disposition Values</span><span>)</span></a>) are ignored. 
</li>
<li>For any remaining label, set the disposition to "allocate". 
</li>
</ul><p>
                
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Conversion to and from Other Formats</h3>

<p>Both
                <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a>
                and
                <a class='info' href='#RFC4290'>[RFC4290]<span> (</span><span class='info'>Klensin, J., &ldquo;Suggested Practices for Registration of Internationalized Domain Names (IDN),&rdquo; December&nbsp;2005.</span><span>)</span></a>
                provide different grammars for IDN tables. These formats are unable
                to fully cater for the increased requirements of contemporary
                IDN variant policies.
            
</p>
<p>This specification is a superset of functionality provided by
                these IDN table formats, thus any table expressed in those formats can be
                expressed in this format. Automated conversion can be conducted
                between tables conformant with the grammar specified in each
                document.
            
</p>
<p>For notes on how to translate an RFC 3743-style table, see <a class='info' href='#translate_rfc3743'>Appendix&nbsp;B<span> (</span><span class='info'>How to Translate RFC 3743 based Tables into the XML Format</span><span>)</span></a>.
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
IANA Considerations</h3>

<p>This document does not specify any IANA actions.
</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Security Considerations</h3>

<p>There are no security considerations for this memo.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.&nbsp;References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ASIA-TABLE">[ASIA-TABLE]</a></td>
<td class="author-text">DotAsia Organisation, &ldquo;.ASIA ZH IDN Language Table.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="LGR-PROCEDURE">[LGR-PROCEDURE]</a></td>
<td class="author-text">Internet Corporation for Assigned Names and Numbers, &ldquo;<a href="http://www.icann.org/en/resources/idn/draft-lgr-procedure-07dec12-en.pdf">Procedure to Develop and Maintain the Label Generation Rules for the Root Zone in Respect of
                        IDNA Labels</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3339">[RFC3339]</a></td>
<td class="author-text"><a href="mailto:GK@ACM.ORG">Klyne, G., Ed.</a> and <a href="mailto:chris.newman@sun.com">C. Newman</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3339">Date and Time on the Internet: Timestamps</a>,&rdquo; RFC&nbsp;3339, July&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3339.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3339.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3339.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3743">[RFC3743]</a></td>
<td class="author-text">Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;<a href="http://tools.ietf.org/html/rfc3743">Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean</a>,&rdquo; RFC&nbsp;3743, April&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3743.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4290">[RFC4290]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4290">Suggested Practices for Registration of Internationalized Domain Names (IDN)</a>,&rdquo; RFC&nbsp;4290, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4290.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5564">[RFC5564]</a></td>
<td class="author-text">El-Sherbiny, A., Farah, M., Oueichek, I., and A. Al-Zoman, &ldquo;<a href="http://tools.ietf.org/html/rfc5564">Linguistic Guidelines for the Use of the Arabic Language in Internet Domains</a>,&rdquo; RFC&nbsp;5564, February&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5564.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5646">[RFC5646]</a></td>
<td class="author-text">Phillips, A. and M. Davis, &ldquo;<a href="http://tools.ietf.org/html/rfc5646">Tags for Identifying Languages</a>,&rdquo; BCP&nbsp;47, RFC&nbsp;5646, September&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5646.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5892">[RFC5892]</a></td>
<td class="author-text">Faltstrom, P., &ldquo;<a href="http://tools.ietf.org/html/rfc5892">The Unicode Code Points and Internationalized Domain Names for Applications (IDNA)</a>,&rdquo; RFC&nbsp;5892, August&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5892.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TDIL-HINDI">[TDIL-HINDI]</a></td>
<td class="author-text">Technology Development for Indian Languages (TDIL) Programme, &ldquo;Devanagari Script Behaviour for Hindi.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="UAX42">[UAX42]</a></td>
<td class="author-text">Unicode Consortium, &ldquo;<a href="http://unicode.org/reports/tr42/">Unicode Character Database in XML</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="Unicode-Stability">[Unicode-Stability]</a></td>
<td class="author-text">Unicode Consortium, &ldquo;<a href="http://www.unicode.org/policies/stability_policy.html#Property_Value">Unicode Encoding Stability Policy, Property Value Stability</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="Unicode-Versions">[Unicode-Versions]</a></td>
<td class="author-text">Unicode Consortium, &ldquo;<a href="http://unicode.org/versions/#Version_Numbering">Unicode Version Numbering</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="XML">[XML]</a></td>
<td class="author-text">World Wide Web Consortium, &ldquo;<a href="http://www.w3.org/TR/REC-xml/">Extensible Markup Language (XML) 1.0</a>.&rdquo;</td></tr>
</table>

<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Example Tables</h3>

<p>The following presents a minimal LGR table defining the lower case LDH (letter-digit-hyphen) repertoire
			and containing no rules or description elements. Many simple LGR tables will look quite similar, except that
			they would contain some meta data.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;lgr xmlns="http://www.iana.org/lgr/0.1"&gt;
&lt;data&gt;
    &lt;char cp="002D" comment="HYPHEN (-)" /&gt;
    &lt;range first-cp="0030" last-cp="0039" comment="DIGIT ZERO ('0') - DIGIT NINE ('9')" /&gt;
    &lt;range first-cp="0061" last-cp="007A" comment="LATIN SMALL LETTER A ('a') - LATTIN SMALL LETTER Z ('z')" /&gt;
&lt;/data&gt;
&lt;/lgr&gt;</pre></div><p>

</p>
<p>The following sample LGR shows a more complete collection of the elements and
                attributes defined in this specification in a somewhat typical context.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;

&lt;!-- This example uses a large subset of the features of this
     specification. It does not include every set operator,
     match operator element, or action trigger attribute, their
     use being largely parallel to the ones demonstrated. --&gt;

&lt;lgr xmlns="http://www.iana.org/lgr/0.1"&gt;
&lt;!-- meta element with all optional elements --&gt;
  &lt;meta&gt;
    &lt;version comment="initial version"&gt;1&lt;/version&gt;
    &lt;date&gt;2010-01-01&lt;/date&gt;
    &lt;language&gt;sv&lt;/language&gt;
    &lt;domain&gt;example&lt;/domain&gt;
    &lt;validity-start&gt;2010-01-01&lt;/validity-start&gt;
    &lt;validity-end&gt;2013-12-31&lt;/validity-end&gt;
    &lt;description type="text/html"&gt;
        &lt;![CDATA[
        This language table was developed with the
        &lt;a href="http://swedish.example/"&gt;Swedish
        examples institute&lt;/a&gt;.
        ]]&gt;
    &lt;/description&gt;
    &lt;unicode-version&gt;6.3.0&lt;/unicode-version&gt;
    &lt;references&gt;
      &lt;reference id="0" comment="the most recent" &gt;The Unicode Standard 6.2&lt;/reference&gt;
      &lt;reference id="1" &gt;RFC 5892&lt;/reference&gt;
      &lt;reference id="2" &gt;Big-5: Computer Chinese Glyph and Character
         Code Mapping Table, Technical Report C-26, 1984&lt;/reference&gt;
    &lt;/references&gt;
 &lt;/meta&gt;
 &lt;!-- the data section describing the repertoire --&gt;
  &lt;data&gt;
    &lt;!-- single code point "char" element --&gt;
    &lt;char cp="002D" ref="1" comment="HYPHEN" /&gt;

    &lt;!-- range elements for contiguous code points,  with tags --&gt;
    &lt;range first-cp="0030" last-cp="0039" ref="1" tag="digit" /&gt;
    &lt;range first-cp="0061" last-cp="007A" ref ="1" tag="letter" /&gt;

    &lt;!-- code point sequence --&gt;
    &lt;char cp="006C 00B7 006C" comment="catalan middle dot" /&gt;

    &lt;!-- alternatively use a when rule --&gt;
    &lt;char cp="00B7" when="catalan-middle-dot" /&gt;

     &lt;!-- code point with context rule --&gt;
    &lt;char cp="200D" when="joiner" ref="2" /&gt;

    &lt;!-- code points with variants --&gt;
    &lt;char cp="4E16" tag="preferred" ref="0"&gt;
      &lt;var cp="4E17" disp="block" ref="2" /&gt;
      &lt;var cp="534B" disp="allocate" ref="2" /&gt;
    &lt;/char&gt;
    &lt;char cp="4E17" ref="0"&gt;
      &lt;var cp="4E16" disp="allocate" ref="2" /&gt;
      &lt;var cp="534B" disp="allocate" ref="2" /&gt;
    &lt;/char&gt;
    &lt;char cp="534B" ref="0"&gt;
      &lt;var cp="4E16" disp="allocate" ref="2" /&gt;
      &lt;var cp="4E17" disp="block" ref="2" /&gt;
    &lt;/char&gt;
  &lt;/data&gt;

  &lt;!-- Context and whole label rules --&gt;
  &lt;rules&gt;
    &lt;!-- Require the given code point to be between two 006C --&gt;
    &lt;rule name="catalan-middle-dot" ref="0"&gt;
        &lt;look-behind&gt;
            &lt;char cp="006C" /&gt;
        &lt;/look-behind&gt;
        &lt;anchor /&gt;
        &lt;look-ahead&gt;
            &lt;char cp="006C" /&gt;
        &lt;/look-ahead&gt;
    &lt;/rule&gt;

    &lt;!-- example of a context rule based on property --&gt;
    &lt;class name="virama" property="ccc:9" /&gt;
    &lt;rule name="joiner"  ref="1" &gt;
        &lt;look-behind&gt;
            &lt;class by-ref="virama" /&gt;
        &lt;/look-behind&gt;
        &lt;anchor /&gt;
    &lt;/rule&gt;

    &lt;!-- example of using set operators --&gt;

    &lt;!-- Subtract vowels from letters to get
         consonant, demonstrating the different
         set notations and the difference operator --&gt;
    &lt;difference name="consonants"&gt;
         &lt;!-- use standard notation --&gt;
         &lt;class comment="all letters"&gt;
           &lt;char cp="0061" /&gt;
           &lt;range first-cp="0062" last-cp="0072" /&gt;
         &lt;/class&gt;
         &lt;!-- use shorthand notation --&gt;
         &lt;class comment="all vowels"&gt;
                 0061 0065 0069 006F 0075-0075
         &lt;/class&gt;
     &lt;/difference&gt;

     &lt;!-- by using the start and end, rule matches whole label --&gt;
     &lt;rule name="three-or-more-consonants"&gt;
         &lt;start /&gt;
         &lt;!-- reference the class defined by the difference
              and require three or more matches --&gt;
         &lt;class by-ref="consonants" count="3+" /&gt;
         &lt;end /&gt;
    &lt;/rule&gt;

    &lt;!-- rule for negative matching --&gt;
    &lt;rule name="non-preferred"
          comment="matches any non-preferred code point"&gt;
        &lt;complement comment="non-preferred" &gt;
            &lt;class from-tag="preferred" /&gt;
        &lt;/complement&gt;
    &lt;/rule&gt;

   &lt;!-- actions triggered by matching rules and/or
        variant dispositions --&gt;
    &lt;action disp="consonants"
            match="three-or-more-consonants" /&gt;
    &lt;action disp="block" any-variant="block" /&gt;
    &lt;action disp="activate" all-variants="allocate"
            not-match="non-preferred" /&gt;
  &lt;/rules&gt;
&lt;/lgr&gt;</pre></div><p>

</p>
<a name="translate_rfc3743"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
How to Translate RFC 3743 based Tables into the XML Format</h3>

<p>As a background, the <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a> rules work as follows:
</p>
<p></p>
<ol class="text">
<li>The Original (requested) label is checked to make sure that all the code points are a subset of the repertoire.
</li>
<li>If it passes the check, the Original label is allocatable.
</li>
<li>Generate the all-simplified and all-traditional variant labels (union of all the labels generated using
       all the simplified variants of the code points)  for allocation.
</li>
</ol><p>

</p>
<p>
   To illustrate by example, here is one of the more complicated set of variants:

</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    U+4E7E
    U+4E81
    U+5E72
    U+5E79
    U+69A6
    U+6F27</pre></div><p>

    
</p>
<p>The following shows the relevant section of the Chinese language table published by the .ASIA registry <a class='info' href='#ASIA-TABLE'>[ASIA&#8209;TABLE]<span> (</span><span class='info'>DotAsia Organisation, &ldquo;.ASIA ZH IDN Language Table,&rdquo; .</span><span>)</span></a>.
       Its entries read:
</p>
<p>    </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre> &lt;codepoint&gt;;&lt;simpl-variant(s)&gt;;&lt;trad-variant(s)&gt;;&lt;other-variant(s)&gt;</pre></div><p>

</p>
<p>These are the lines corresponding to the set of variants listed above
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>U+4E7E;U+4E7E,U+5E72;U+4E7E;U+4E81,U+5E72,U+6F27,U+5E79,U+69A6
U+4E81;U+5E72;U+4E7E;U+5E72,U+6F27,U+5E79,U+69A6
U+5E72;U+5E72;U+5E72,U+4E7E,U+5E79;U+4E7E,U+4E81,U+69A6,U+6F27
U+5E79;U+5E72;U+5E79;U+69A6,U+4E7E,U+4E81,U+6F27
U+69A6;U+5E72;U+69A6;U+5E79,U+4E7E,U+4E81,U+6F27
U+6F27;U+4E7E;U+6F27;U+4E81,U+5E72,U+5E79,U+69A6</pre></div><p>

</p>
<p>
    The corresponding data section XML format would look like this:
</p>
<p>
    </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;data&gt;
    &lt;char cp="4E7E"&gt;
    &lt;var cp="4E7E" disp="both" comment="identity" /&gt;
    &lt;var cp="4E81" disp="block" /&gt;
    &lt;var cp="5E72" disp="simp" /&gt;
    &lt;var cp="5E79" disp="block" /&gt;
    &lt;var cp="69A6" disp="block" /&gt;
    &lt;var cp="6F27" disp="block" /&gt;
    &lt;/char&gt;
    &lt;char cp="4E81"&gt;
    &lt;var cp="4E7E" disp="trad" /&gt;
    &lt;var cp="5E72" disp="simp" /&gt;
    &lt;var cp="5E79" disp="block" /&gt;
    &lt;var cp="69A6" disp="block" /&gt;
    &lt;var cp="6F27" disp="block" /&gt;
    &lt;/char&gt;
    &lt;char cp="5E72"&gt;
    &lt;var cp="4E7E" disp="trad"/&gt;
    &lt;var cp="4E81" disp="block"/&gt;
    &lt;var cp="5E72" disp="both" comment="identity"/&gt;
    &lt;var cp="5E79" disp="trad"/&gt;
    &lt;var cp="69A6" disp="block"/&gt;
    &lt;var cp="6F27" disp="block"/&gt;
    &lt;/char&gt;
    &lt;char cp="5E79"&gt;
    &lt;var cp="4E7E" disp="block"/&gt;
    &lt;var cp="4E81" disp="block"/&gt;
    &lt;var cp="5E72" disp="simp"/&gt;
    &lt;var cp="5E79" disp="trad" comment="identity"/&gt;
    &lt;var cp="69A6" disp="block"/&gt;
    &lt;var cp="6F27" disp="block"/&gt;
    &lt;/char&gt;
    &lt;char cp="69A6"&gt;
    &lt;var cp="4E7E" disp="block"/&gt;
    &lt;var cp="4E81" disp="block"/&gt;
    &lt;var cp="5E72" disp="simp"/&gt;
    &lt;var cp="5E79" disp="block"/&gt;
    &lt;var cp="69A6" disp="trad" comment="identity"/&gt;
    &lt;var cp="6F27" disp="block"/&gt;
    &lt;/char&gt;
    &lt;char cp="6F27"&gt;
    &lt;var cp="4E7E" disp="simp"/&gt;
    &lt;var cp="4E81" disp="block"/&gt;
    &lt;var cp="5E72" disp="block"/&gt;
    &lt;var cp="5E79" disp="block"/&gt;
    &lt;var cp="69A6" disp="block"/&gt;
    &lt;var cp="6F27" disp="trad" comment="identity"/&gt;
    &lt;/char&gt;
  &lt;/data&gt;</pre></div><p>

</p>
<p>
    Here the simplified variants have been given a disposition of "simp",
    the traditional variants one of "trad" and all other ones are given "block".
    
</p>
<p>
    Note that some variant mappings map to themselves (identity), that is
    the mapping is reflexive (see <a class='info' href='#reflexive_mapping'>Section&nbsp;5.2.5<span> (</span><span class='info'>Variants with Reflexive Mapping</span><span>)</span></a>).
    In creating the permutation of all variant labels, these mappings have
    no effect, other than adding a value to the variant disposition list
    for the variant label containing them.
    
</p>
<p>
    Because some variant mappings show in more than one column, while
    the XML format allows only a single disposition value, they have
    been given the disposition of "both".
    
</p>
<p>In the example so far, all of these are  also mappings where source
    and target are identical that is, reflexive mappings as defined in <a class='info' href='#reflexive_mapping'>Section&nbsp;5.2.5<span> (</span><span class='info'>Variants with Reflexive Mapping</span><span>)</span></a>.
    
</p>
<p>
     Given a label "U+4E7E U+4E81", the following labels would be ruled
     allocatable under <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a> based on how that standard is commonly
     implemented in domain registries:
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    Original label:     U+4E7E U+4E81
    Simplified label 1: U+4E7E U+5E72
    Simplified label 2: U+5E72 U+5E72
    Traditional label:  U+4E7E U+4E7E</pre></div><p>

</p>
<p>
    However, If we generated allocatable labels without regard to the 
    simplified-to-traditional variants, we would end up with an extra allocatable
    label: "U+5E72 U+4E7E". That label is comprised of an SC character and a TC
    character which shouldn't be allocatable, but it would be the result of a straight
    permutation of all variants with disposition other than disp="block".

</p>
<p>
    To more fully resolve the dispositions requires several actions to be defined as 
    described in <a class='info' href='#rfc3743_example'>Section&nbsp;7.2.2<span> (</span><span class='info'>Example for RFC3743-style Tables</span><span>)</span></a>. After blocking all labels that
    contain a variant with disposition "block", these actions will first allocate all labels that
    consist entirely of variants (including variants with reflexive mappings) that are "simp" or "both", then do
    likewise for labels that are entirely "trad" or "both". All surviving labels containing
    any one of the dispositions "simp" or "trad" are now known to be part of an undesirable mixed
    simplified/traditional label and are blocked. Finally, the remaining labels must be code points without
    variants or reflexive variants of type "both", in other words, the original label.

</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>  &lt;rules&gt;
    &lt;!--Action elements - order defines precedence--&gt;
    &lt;action disp="block" any-variant="block"
        comment="filter out by blocked code point" /&gt;
    &lt;action disp="allocate"
        only-variants="simp both"
        comment="only allocate if simplified variant
        including reflexive (identity) mapping" /&gt;
    &lt;action disp="allocate"
        only-variants="trad both"
        comment="only allocate if traditional variant,
        including reflexive (identity) mapping" /&gt;
    &lt;action disp="block"
        any-variant="simp trad"
        comment="filter out any remaining variant code point" /&gt;
    &lt;action disp="activate" comment="surviving labels must be
        original labels" /&gt;
  &lt;/rules&gt;</pre></div><p>

</p>
<p>In the example above, variants with the disposition "both" occur only as part of identity 
 mappings (as pointed out in the comments). The scheme described so far relies on the assumption
 that this is always the case. However, consider the following set of variants:
 
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    U+62E0;U+636E;U+636E;U+64DA
    U+636E;U+636E;U+64DA;U+62E0
    U+64DA;U+636E;U+64DA;U+62E0</pre></div><p>

</p>
<p>for which the corresponding XML would be:
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;char cp="62E0"&gt;
    &lt;var cp="636E" disp="both" comment=" BOTH, but NOT identity" /&gt;
    &lt;var cp="64DA" disp="block" /&gt;
    &lt;/char&gt;
    &lt;char cp="636E"&gt;
    &lt;var cp="636E" disp="simp" comment="identity, but not BOTH" /&gt;
    &lt;var cp="64DA" disp="trad" /&gt;
    &lt;var cp="62E0" disp="block" /&gt;
    &lt;/char&gt;
    &lt;char cp="64DA"&gt;
    &lt;var cp="636E" disp="simp" /&gt;
    &lt;var cp="64DA" disp="trad" comment="identity" /&gt;
    &lt;var cp="62E0" disp="block" /&gt;
    &lt;/char&gt;</pre></div><p>

</p>
<p>
    What is needed to make such variant sets work is a way to capture when a
    disposition is associated with an identity or reflexive mapping, and when it is associated with an
    ordinary variant mapping. This can be done by adding a prefix "i-" in front of the disposition
    whenever the mapping is an identity mapping, for example the last "trad" in the
    preceding figure would become "i-trad".
</p>
<p>
    With all the dispositions prepared in this way, only a slight modification to the actions
    is needed to yield the correct set of allocatable labels:
    
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    &lt;action disp="block" any-variant="block" /&gt;
    &lt;action disp="allocate" only-variants="simp i-simp both i-both" /&gt;
    &lt;action disp="allocate" only-variants="trad i-trad both i-both" /&gt;
    &lt;action disp="block" all-variants="simp trad both" /&gt;
    &lt;action disp="allocate" /&gt;
</pre></div><p>

</p>
<p>The first three actions get triggered by the same labels as before.
</p>
<p>
          The fourth action blocks any label that combines an original code point
          with any of the variant mappings, yet lets through all labels that are a
          combination of only  original code points (everything having either no variant
          mapping or one of the identity mappings). These are the original labels
          and they are allocated in the last action.
</p>
<p>With this modification all RFC 3743-style tables can be converted
          to XML and, by using the above set of actions, the result will be that
          all variants consisting completely of variants preferred for simplified
          or traditional, respectively, will be allocated, as will be the original label.
          All other variant labels will be blocked.
</p>
<a name="indic_syllable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Indic Syllable Structure Example</h3>

<p>
        In LGRs for Indic scripts it may be desirable to restrict valid labels to sequences
        of valid Indic syllables, or aksharas. This appendix gives a sample set of rules
        designed to enforce this restriction.
        
</p>
<p>We start with the following BNF form for an akshara which has been
        published in “Devanagari Script Behavior for Hindi" <a class='info' href='#TDIL-HINDI'>[TDIL&#8209;HINDI]<span> (</span><span class='info'>Technology Development for Indian Languages (TDIL) Programme, &ldquo;Devanagari Script Behaviour for Hindi,&rdquo; .</span><span>)</span></a> but which,
        if not directly valid for other languages and scripts used in India is at least similar
        to equivalent definitions used for them.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    V[m]|{C[N]H}C[N](H|[v][m])</pre></div><p>

</p>
<p>Where:
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>V</dt>
<dd>(upper case) is any independent vowel
</dd>
<dt>m</dt>
<dd> is any vowel modifier (Devanagari Anusvara, Visarga, and Candrabindu)
</dd>
<dt>C</dt>
<dd> is any consonant (with inherent vowel)
</dd>
<dt>N</dt>
<dd> is Nukta
</dd>
<dt>H</dt>
<dd> is a Halant (or Virama)
</dd>
<dt>v</dt>
<dd> (lower case) is any dependent vowel sign (matra)
</dd>
<dt>{}</dt>
<dd> encloses items which may be repeated one or more times
</dd>
<dt>[ ]</dt>
<dd> encloses items which may or may not be present
</dd>
<dt>|</dt>
<dd> separates items, out of which only one can be present
</dd>
</dl></blockquote><p>
	
</p>
<p>
     By using the Unicode property "InSC" or "Indic_Syllable_Category" which corresponds
     rather directly to the classification of characters in the BNF above, we can directly
     translate the BNF into a set of WLE rules matching the definition of an akshara.
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre> &lt;rules&gt;
    &lt;!--Character Class Definitions go here--&gt;
    &lt;class name="halant" property="InSC:Virama" /&gt;
    &lt;union name="vowel-modifier"&gt;
      &lt;class property="InSC:Visarga" /&gt;
      &lt;class property="InSC:Bindu" comment="includes anusvara" /&gt;
    &lt;/union&gt;
    &lt;!--Whole label evaluation and Context rules go here--&gt;
    &lt;rule name="consonant-with-optional-nukta"&gt;
        &lt;class by-ref="InSC:Consonant" /&gt;
        &lt;class by-ref="InSC:Nukta"  count="0:1"/&gt;
    &lt;/rule&gt;
    &lt;rule name="independent-vowel-with-optional-modifier"&gt;
        &lt;class by-ref="InSC:Vowel_Independent" /&gt;
        &lt;class by-ref="vowel-modifier"  count="0:1" /&gt;
    &lt;/rule&gt;
    &lt;rule name="optional-dependent-vowel-with-optional-modifier" &gt;
      &lt;class by-ref="InSC:Vowel_Dependent" count="0:1" /&gt;
      &lt;class by-ref="vowel-modifier" count="0:1"  /&gt;
    &lt;/rule&gt;
    &lt;rule name="consonant-cluster"&gt;
      &lt;rule count="0+"&gt;
        &lt;rule by-ref="consonant-with-optional-nukta" /&gt;
        &lt;class by-ref="halant" /&gt;
      &lt;/rule&gt;
      &lt;rule by-ref="consonant-with-optional-nukta" /&gt;
      &lt;choice&gt;
        &lt;class by-ref="halant" /&gt;
        &lt;rule by-ref="optional-dependent-vowel-with-optional-modifier" /&gt;
      &lt;/choice&gt;
    &lt;/rule&gt;
    &lt;rule name="akshara"&gt;
      &lt;choice&gt;
        &lt;rule by-ref="independent-vowel-with-optional-modifier" /&gt;
        &lt;rule by-ref="consonant-cluster" /&gt;
      &lt;/choice&gt;
    &lt;/rule&gt;
    &lt;rule name="WLE-akshara-or-other" comment="series of one or
        more aksharas, possibly alternating with other types of
        code points such as digits"&gt;
      &lt;start /&gt;
      &lt;choice count="1+"&gt;
        &lt;class property="InSC:other"  /&gt;
        &lt;rule by-ref="akshara"  /&gt;
      &lt;/choice&gt;
      &lt;end /&gt;
    &lt;/rule&gt;
    &lt;!--Action elements go here - order defines precedence--&gt;
    &lt;action disp="invalid" not-match="WLE-akshara-or-other" /&gt;
  &lt;/rules&gt;</pre></div><p>

</p>
<p>
    With the rules and classes as defined above, the final action assigns a disposition of "invalid" to
    all labels that are not composed of a sequence of well-formed aksharas, optionally interspersed
    with other characters, perhaps digits, for example.
</p>
<p>
    The relevant Unicode property is as of this writing still considered provisional;
    however, it could be replicated by tagging repertoire values directly in the LGR
    which would remove the dependency on the Unicode Standard altogether.
    
</p>
<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
RelaxNG Schema</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;grammar xmlns:a="http://relaxng.org/ns/compatibility/annotations/1.0"
   xmlns="http://relaxng.org/ns/structure/1.0" ns="http://www.iana.org/lgr/0.1"
   datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes"&gt;
  &lt;define name="language-tag"&gt;
    &lt;data type="token"/&gt;
  &lt;/define&gt;
  &lt;define name="domain-name"&gt;
    &lt;text/&gt;
  &lt;/define&gt;
  &lt;define name="code-point"&gt;
    &lt;data type="token"&gt;
      &lt;param name="pattern"&gt;[0-9A-F]{4,6}&lt;/param&gt;
    &lt;/data&gt;
  &lt;/define&gt;
  &lt;define name="code-point-sequence"&gt;
    &lt;data type="token"&gt;
      &lt;param name="pattern"&gt;[0-9A-F]{4,6}( [0-9A-F]{4,6})+&lt;/param&gt;
    &lt;/data&gt;
  &lt;/define&gt;
  &lt;define name="code-point-literal"&gt;
    &lt;choice&gt;
      &lt;ref name="code-point"/&gt;
      &lt;ref name="code-point-sequence"/&gt;
    &lt;/choice&gt;
  &lt;/define&gt;
  &lt;define name="date"&gt;
    &lt;data type="token"&gt;
      &lt;param name="pattern"&gt;\d{4}-\d\d-\d\d&lt;/param&gt;
    &lt;/data&gt;
  &lt;/define&gt;
  &lt;define name="rule-ref"&gt;
    &lt;data type="IDREF"/&gt;
  &lt;/define&gt;
  &lt;define name="tag"&gt;
    &lt;text/&gt;
  &lt;/define&gt;
  &lt;define name="identifier"&gt;
    &lt;data type="ID"/&gt;
  &lt;/define&gt;
  &lt;define name="class-ref"&gt;
    &lt;text/&gt;
  &lt;/define&gt;
  &lt;define name="count-pattern"&gt;
    &lt;data type="token"&gt;
      &lt;param name="pattern"&gt;\d+(\+|:\d+)?&lt;/param&gt;
    &lt;/data&gt;
  &lt;/define&gt;
  &lt;define name="char"&gt;
    &lt;element name="char"&gt;
      &lt;attribute name="cp"&gt;
        &lt;ref name="code-point-literal"/&gt;
      &lt;/attribute&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="when"&gt;
          &lt;ref name="rule-ref"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="not-when"&gt;
          &lt;ref name="rule-ref"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="tag"&gt;
          &lt;ref name="tag"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="ref"/&gt;
      &lt;/optional&gt;
      &lt;zeroOrMore&gt;
        &lt;ref name="variant"/&gt;
      &lt;/zeroOrMore&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="char-single"&gt;
    &lt;element name="char"&gt;
      &lt;attribute name="cp"&gt;
        &lt;ref name="code-point"/&gt;
      &lt;/attribute&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="ref"/&gt;
      &lt;/optional&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="range"&gt;
    &lt;element name="range"&gt;
      &lt;attribute name="first-cp"&gt;
        &lt;ref name="code-point-literal"/&gt;
      &lt;/attribute&gt;
      &lt;attribute name="last-cp"&gt;
        &lt;ref name="code-point-literal"/&gt;
      &lt;/attribute&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="tag"&gt;
          &lt;ref name="tag"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="ref"/&gt;
      &lt;/optional&gt;
      &lt;text/&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="variant"&gt;
    &lt;element name="var"&gt;
      &lt;attribute name="cp"&gt;
        &lt;ref name="code-point-literal"/&gt;
      &lt;/attribute&gt;
      &lt;optional&gt;
        &lt;attribute name="type"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="when"&gt;
          &lt;ref name="rule-ref"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="not-when"&gt;
          &lt;ref name="rule-ref"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="disp"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="ref"/&gt;
      &lt;/optional&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="class-invocation"&gt;
    &lt;element name="class"&gt;
      &lt;attribute name="by-ref"&gt;
        &lt;ref name="class-ref"/&gt;
      &lt;/attribute&gt;
      &lt;optional&gt;
        &lt;attribute name="count"&gt;
          &lt;ref name="count-pattern"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="class-declaration"&gt;
    &lt;element name="class"&gt;
      &lt;optional&gt;
        &lt;attribute name="name"&gt;
          &lt;ref name="identifier"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="count"&gt;
          &lt;ref name="count-pattern"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="ref"/&gt;
      &lt;/optional&gt;
      &lt;choice&gt;
        &lt;attribute name="property"/&gt;
        &lt;oneOrMore&gt;
          &lt;choice&gt;
            &lt;ref name="char-single"/&gt;
            &lt;ref name="range"/&gt;
          &lt;/choice&gt;
        &lt;/oneOrMore&gt;
        &lt;text/&gt;
      &lt;/choice&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="class-or-set-operator-nested"&gt;
    &lt;choice&gt;
      &lt;ref name="class-invocation"/&gt;
      &lt;ref name="class-declaration"/&gt;
      &lt;ref name="set-operator"/&gt;
    &lt;/choice&gt;
  &lt;/define&gt;
  &lt;define name="class-or-set-operator-declaration"&gt;
    &lt;choice&gt;
      &lt;ref name="class-declaration"/&gt;
      &lt;ref name="set-operator"/&gt;
    &lt;/choice&gt;
  &lt;/define&gt;
  &lt;define name="complement-operator"&gt;
    &lt;element name="complement"&gt;
      &lt;optional&gt;
        &lt;attribute name="name"&gt;
          &lt;ref name="identifier"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="count"&gt;
          &lt;ref name="count-pattern"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;ref name="class-or-set-operator-nested"/&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="union-operator"&gt;
    &lt;element name="union"&gt;
      &lt;optional&gt;
        &lt;attribute name="name"&gt;
          &lt;ref name="identifier"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="count"&gt;
          &lt;ref name="count-pattern"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;ref name="class-or-set-operator-nested"/&gt;
      &lt;oneOrMore&gt;
        &lt;ref name="class-or-set-operator-nested"/&gt;
      &lt;/oneOrMore&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="intersection-operator"&gt;
    &lt;element name="intersection"&gt;
      &lt;optional&gt;
        &lt;attribute name="name"&gt;
          &lt;ref name="identifier"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="count"&gt;
          &lt;ref name="count-pattern"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;ref name="class-or-set-operator-nested"/&gt;
      &lt;ref name="class-or-set-operator-nested"/&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="difference-operator"&gt;
    &lt;element name="difference"&gt;
      &lt;optional&gt;
        &lt;attribute name="name"&gt;
          &lt;ref name="identifier"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="count"&gt;
          &lt;ref name="count-pattern"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;ref name="class-or-set-operator-nested"/&gt;
      &lt;ref name="class-or-set-operator-nested"/&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="symmetric-difference-operator"&gt;
    &lt;element name="symmetric-difference"&gt;
      &lt;optional&gt;
        &lt;attribute name="name"&gt;
          &lt;ref name="identifier"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="count"&gt;
          &lt;ref name="count-pattern"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;ref name="class-or-set-operator-nested"/&gt;
      &lt;ref name="class-or-set-operator-nested"/&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="set-operator"&gt;
    &lt;choice&gt;
      &lt;ref name="complement-operator"/&gt;
      &lt;ref name="union-operator"/&gt;
      &lt;ref name="intersection-operator"/&gt;
      &lt;ref name="difference-operator"/&gt;
      &lt;ref name="symmetric-difference-operator"/&gt;
    &lt;/choice&gt;
  &lt;/define&gt;
  &lt;define name="any-matcher"&gt;
    &lt;element name="any"&gt;
      &lt;optional&gt;
        &lt;attribute name="count"&gt;
          &lt;ref name="count-pattern"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="choice-matcher"&gt;
    &lt;element name="choice"&gt;
      &lt;optional&gt;
        &lt;attribute name="count"&gt;
          &lt;ref name="count-pattern"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;ref name="match-operator"/&gt;
      &lt;oneOrMore&gt;
        &lt;ref name="match-operator"/&gt;
      &lt;/oneOrMore&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="char-matcher"&gt;
    &lt;element name="char"&gt;
      &lt;attribute name="cp"&gt;
        &lt;ref name="code-point-literal"/&gt;
      &lt;/attribute&gt;
      &lt;optional&gt;
        &lt;attribute name="count"&gt;
          &lt;ref name="count-pattern"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="ref"/&gt;
      &lt;/optional&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="start-matcher"&gt;
    &lt;element name="start"&gt;
      &lt;empty/&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="end-matcher"&gt;
    &lt;element name="end"&gt;
      &lt;empty/&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="anchor-matcher"&gt;
    &lt;element name="anchor"&gt;
      &lt;empty/&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="look-ahead-matcher"&gt;
    &lt;element name="look-ahead"&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;oneOrMore&gt;
        &lt;ref name="match-operator"/&gt;
      &lt;/oneOrMore&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="look-behind-matcher"&gt;
    &lt;element name="look-behind"&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;oneOrMore&gt;
        &lt;ref name="match-operator"/&gt;
      &lt;/oneOrMore&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="match-operator"&gt;
    &lt;choice&gt;
      &lt;ref name="any-matcher"/&gt;
      &lt;ref name="choice-matcher"/&gt;
      &lt;ref name="start-matcher"/&gt;
      &lt;ref name="end-matcher"/&gt;
      &lt;ref name="char-matcher"/&gt;
      &lt;ref name="class-or-set-operator-nested"/&gt;
      &lt;ref name="rule-matcher"/&gt;
      &lt;ref name="anchor-matcher"/&gt;
      &lt;ref name="look-ahead-matcher"/&gt;
      &lt;ref name="look-behind-matcher"/&gt;
    &lt;/choice&gt;
  &lt;/define&gt;
  &lt;define name="rule-declaration-top"&gt;
    &lt;element name="rule"&gt;
      &lt;attribute name="name"&gt;
        &lt;ref name="identifier"/&gt;
      &lt;/attribute&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="ref"/&gt;
      &lt;/optional&gt;
      &lt;oneOrMore&gt;
        &lt;ref name="match-operator"/&gt;
      &lt;/oneOrMore&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="rule-matcher"&gt;
    &lt;element name="rule"&gt;
      &lt;optional&gt;
        &lt;attribute name="count"&gt;
          &lt;ref name="count-pattern"/&gt;
        &lt;/attribute&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;choice&gt;
        &lt;attribute name="by-ref"&gt;
          &lt;ref name="rule-ref"/&gt;
        &lt;/attribute&gt;
        &lt;oneOrMore&gt;
          &lt;ref name="match-operator"/&gt;
        &lt;/oneOrMore&gt;
      &lt;/choice&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="action-declaration"&gt;
    &lt;element name="action"&gt;
      &lt;optional&gt;
        &lt;attribute name="comment"/&gt;
      &lt;/optional&gt;
      &lt;attribute name="disp"/&gt;
      &lt;optional&gt;
        &lt;choice&gt;
          &lt;attribute name="match"/&gt;
          &lt;attribute name="not-match"/&gt;
        &lt;/choice&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;choice&gt;
          &lt;attribute name="any-variant"/&gt;
          &lt;attribute name="all-variants"/&gt;
          &lt;attribute name="only-variants"/&gt;
        &lt;/choice&gt;
      &lt;/optional&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;start&gt;
    &lt;ref name="lgr"/&gt;
  &lt;/start&gt;
  &lt;define name="lgr"&gt;
    &lt;element name="lgr"&gt;
      &lt;optional&gt;
        &lt;attribute name="id"/&gt;
      &lt;/optional&gt;
      &lt;optional&gt;
        &lt;ref name="meta-section"/&gt;
      &lt;/optional&gt;
      &lt;ref name="data-section"/&gt;
      &lt;optional&gt;
        &lt;ref name="rules-section"/&gt;
      &lt;/optional&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="meta-section"&gt;
    &lt;element name="meta"&gt;
      &lt;zeroOrMore&gt;
        &lt;choice&gt;
          &lt;element name="version"&gt;
            &lt;optional&gt;
              &lt;attribute name="comment"/&gt;
            &lt;/optional&gt;
            &lt;text/&gt;
          &lt;/element&gt;
          &lt;optional&gt;
            &lt;element name="date"&gt;
              &lt;ref name="date"/&gt;
            &lt;/element&gt;
          &lt;/optional&gt;
          &lt;zeroOrMore&gt;
            &lt;element name="language"&gt;
              &lt;ref name="language-tag"/&gt;
            &lt;/element&gt;
          &lt;/zeroOrMore&gt;
          &lt;zeroOrMore&gt;
            &lt;element name="domain"&gt;
              &lt;ref name="domain-name"/&gt;
            &lt;/element&gt;
          &lt;/zeroOrMore&gt;
          &lt;optional&gt;
            &lt;element name="validity-start"&gt;
              &lt;text/&gt;
            &lt;/element&gt;
          &lt;/optional&gt;
          &lt;optional&gt;
            &lt;element name="validity-end"&gt;
              &lt;text/&gt;
            &lt;/element&gt;
          &lt;/optional&gt;
          &lt;zeroOrMore&gt;
            &lt;element name="unicode-version"&gt;
              &lt;text/&gt;
            &lt;/element&gt;
          &lt;/zeroOrMore&gt;
          &lt;zeroOrMore&gt;
            &lt;element name="description"&gt;
              &lt;optional&gt;
                &lt;attribute name="type"/&gt;
              &lt;/optional&gt;
              &lt;text/&gt;
            &lt;/element&gt;
          &lt;/zeroOrMore&gt;
          &lt;optional&gt;
            &lt;element name="references"&gt;
              &lt;zeroOrMore&gt;
                &lt;element name="reference"&gt;
                  &lt;attribute name="id"/&gt;
                  &lt;optional&gt;
                    &lt;attribute name="comment"/&gt;
                  &lt;/optional&gt;
                  &lt;text/&gt;
                &lt;/element&gt;
              &lt;/zeroOrMore&gt;
            &lt;/element&gt;
          &lt;/optional&gt;
        &lt;/choice&gt;
      &lt;/zeroOrMore&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="data-section"&gt;
    &lt;element name="data"&gt;
      &lt;oneOrMore&gt;
        &lt;choice&gt;
          &lt;ref name="char"/&gt;
          &lt;ref name="range"/&gt;
        &lt;/choice&gt;
      &lt;/oneOrMore&gt;
    &lt;/element&gt;
  &lt;/define&gt;
  &lt;define name="rules-section"&gt;
    &lt;element name="rules"&gt;
      &lt;zeroOrMore&gt;
        &lt;ref name="class-or-set-operator-declaration"/&gt;
      &lt;/zeroOrMore&gt;
      &lt;zeroOrMore&gt;
        &lt;ref name="rule-declaration-top"/&gt;
      &lt;/zeroOrMore&gt;
      &lt;zeroOrMore&gt;
        &lt;ref name="action-declaration"/&gt;
      &lt;/zeroOrMore&gt;
    &lt;/element&gt;
  &lt;/define&gt;
&lt;/grammar&gt;
</pre></div>
<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.E"></a><h3>Appendix E.&nbsp;
Acknowledgements</h3>

<p>This format builds upon the work on documenting IDN tables by many different registry operators. Notably,
                a comprehensive language table for Chinese, Japanese and Korean was developed by the "Joint Engineering
                Team"
                <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a>
                that is the basis of many registry policies; and a set of guidelines for Arabic script registrations
                <a class='info' href='#RFC5564'>[RFC5564]<span> (</span><span class='info'>El-Sherbiny, A., Farah, M., Oueichek, I., and A. Al-Zoman, &ldquo;Linguistic Guidelines for the Use of the Arabic Language in Internet Domains,&rdquo; February&nbsp;2010.</span><span>)</span></a>
                was published by the Arabic-language community.
            
</p>
<p>Contributions that have shaped this document have been provided by Francisco Arias, Mark Davis, Paul Hoffman,
			    Nicholas Ostler, Thomas Roessler, Steve Sheng, Michel Suignard, Andrew Sullivan, Wil Tan and John Yunker.
            
</p>
<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.F"></a><h3>Appendix F.&nbsp;
Editorial Notes</h3>

<p>This appendix to be removed prior to final publication.
</p>
<a name="anchor43"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.F.1"></a><h3>F.1.&nbsp;
Known Issues and Future Work</h3>

<p>
                    </p>
<ul class="text">
<li>A method of specifying the origin URI for a table, and an expiration or refresh policy, as meta-data may
                        be a useful way to declare how the table will be updated.
</li>
<li>The "domain" element should be specified
                        as absolute, so that the Root can be identified as needed for the Root Zone LGR.
</li>
<li>The recommended names for disposition ("block" and "allocate") deviate from the name in the Root Zone
                        LGR Procedure ("blocked" and "allocatable"). The latter were chosen to highlight that the machine
                        processing of the LGR table is just the first step, actual allocation requires additional actions, hence
                        "allocatable". This should be resolved.
</li>
</ul><p>
                
</p>
<a name="anchor44"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.F.2"></a><h3>F.2.&nbsp;
Change History</h3>

<p>
                    </p>
<blockquote class="text"><dl>
<dt>-00</dt>
<dd>Initial draft.
</dd>
</dl></blockquote><p>
                    </p>
<blockquote class="text"><dl>
<dt>-01</dt>
<dd>Add an XML Namespace, and fix other XML nits. Add support for sequences of
                            code points. Improve on consistently using Unicode nomenclature.
                        
</dd>
</dl></blockquote><p>
                    </p>
<blockquote class="text"><dl>
<dt>-02</dt>
<dd>Add support for validity periods.
</dd>
</dl></blockquote><p>
                    </p>
<blockquote class="text"><dl>
<dt>-03</dt>
<dd>Incorporate requirements from the Label Generation Ruleset Procedure for the
                            DNS Root Zone. These requirements include a detailed grammar for specifying whole-label
                            variants, and the ability to explicitly declare of the actions associated with a specific
                            variant. The document also consistently applies the term "Label Generation Ruleset", rather
                            than "IDN table", to reflect the policy term now being used to describe these.
                        
</dd>
</dl></blockquote><p>
                    </p>
<blockquote class="text"><dl>
<dt>-04</dt>
<dd>Support reference information per <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a>. Update 
                        description in response to feedback. Extend the context rules to "char" elements and allow
                        for inverse matching ("not-when"). Extend the description of label processing and implied actions,
                        and allow for actions that reference disposition attributes on any or all variant mappings used
                        in the generation of a variant label.
                        
</dd>
</dl></blockquote><p>
                    </p>
<blockquote class="text"><dl>
<dt>-05</dt>
<dd>Change the name of the "disposition" attribute to "disp".  Add comment
                        attribute on version and reference elements. Allow empty "cp" attributes in char
                        elements to support expressing symmetric mapping of null variants. Describe use of variants that map identically.
                        Clarify how actions are triggered, in particular based on variant dispositions, as well as description of default actions.
                        Revise description of processing a label and its variants. Move example table at the head of appendices. Add "only-variants"
                        attribute. Change "name" attribute to "by-ref" attribute for referencing named classes and rules.  Change "not" to "complement".
                        Remove "match" attribute on rules as redundant if "start" and "end" are supported.
                        Rename "match" element to "anchor" as better fitting it's function and removing confusion with both the "match"
                        attribute on actions as well as the generic term Match Operator. Augmented the examples relevant to <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a>.
</dd>
</dl></blockquote><p>
                    </p>
<blockquote class="text"><dl>
<dt>-06</dt>
<dd>Extend the discussion of reflexive variants and their use; includes update of the appendix on
                    converting  tables in the style of <a class='info' href='#RFC3743'>[RFC3743]<span> (</span><span class='info'>Konishi, K., Huang, K., Qian, H., and Y. Ko, &ldquo;Joint Engineering Team (JET) Guidelines for Internationalized Domain Names (IDN) Registration and Administration for Chinese, Japanese, and Korean,&rdquo; April&nbsp;2004.</span><span>)</span></a>. Improve description of tagging and
                     clarify that it doesn't apply to sequences. Specify that root zone uses ".". Add an appendix with an Indic Syllable
                     Structure example. Extend count attribute to allow maximal counts.
</dd>
</dl></blockquote><p>
					</p>
<blockquote class="text"><dl>
<dt>-07</dt>
<dd>Change "byref" to "by-ref". Add list of recommended properties. Change "location" to 
					"positional" for collective name of start/end match operators. Use from-tag instead of by-ref for tag-based
					classes. Made optional or mutually exclusive nature of some attributes more explicit. Allowing "comment" 
					attributs on all child elements of "rules" except "char" and "range" elements used as child elements of "class".
					[Schema update for that TBD]
</dd>
</dl></blockquote><p>
                
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kim Davies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Internet Corporation for Assigned Names and Numbers</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">12025 Waterfront Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Los Angeles, CA  90094</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 310 301 5800</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:kim.davies@icann.org">kim.davies@icann.org</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.icann.org/">http://www.icann.org/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Asmus Freytag</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">ASMUS Inc.</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:asmus@unicode.org">asmus@unicode.org</a></td></tr>
</table>
</body></html>
